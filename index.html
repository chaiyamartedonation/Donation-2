<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบรับบริจาค - วัดไชยามาตย์</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600;700&family=Kanit:wght@300;400;500;600;700&family=Mitr:wght@300;400;500;600;700&family=Mali:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map for Modules -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"
        }
    }
    </script>

    <style>
        /* Base styles */
        body { 
            font-family: 'Prompt', sans-serif; 
        }
        
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes scaleUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-scale-up { animation: scaleUp 0.3s ease-out forwards; }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3); } 50% { opacity: 1; transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); } }
        .animate-bounce-in { animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }

        /* ========================================= */
        /* CSS สำหรับการพิมพ์ (แบบทางการ OFFICIAL)     */
        /* ========================================= */
        @media print {
            /* ซ่อนทุกอย่างก่อน */
            body * { visibility: hidden; }
            
            /* แสดงเฉพาะส่วน Container ของรายงาน */
            .print-container, .print-container * { visibility: visible; }

            /* ตั้งค่าหน้ากระดาษ */
            body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
                height: auto !important;
                overflow: visible !important;
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important;
            }

            /* บังคับใช้ฟอนต์สารบรรณสำหรับการพิมพ์ */
            body, .print-container * {
                font-family: 'Sarabun', sans-serif !important;
                color: black !important;
            }

            /* จัดตำแหน่ง Container ให้พอดีกระดาษ */
            .print-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100% !important;
                padding: 40px 50px !important; /* ระยะขอบกระดาษมาตรฐาน */
                background: white !important;
                border: none !important;
                box-shadow: none !important;
                display: block !important;
            }

            /* ซ่อนปุ่มและส่วนที่ไม่ต้องการพิมพ์ */
            .no-print { display: none !important; }
            .screen-only { display: none !important; }

            /* แสดงส่วนที่ซ่อนไว้บนหน้าจอปกติ */
            .print-header-official { display: block !important; }
            .print-summary-official { display: block !important; }
            .signature-section { display: flex !important; }

            /* ตารางแบบทางการ */
            table { 
                width: 100% !important; 
                border-collapse: collapse !important; 
                margin-top: 20px;
                margin-bottom: 20px;
            }
            th {
                border: 1px solid black !important;
                padding: 8px !important;
                font-size: 14px !important;
                font-weight: bold !important;
                background-color: #f0f0f0 !important;
                text-align: center !important;
            }
            td {
                border: 1px solid black !important;
                padding: 8px !important;
                font-size: 14px !important;
                vertical-align: top;
            }
            
            /* Badge สถานะตอนพิมพ์ให้เป็นข้อความธรรมดา */
            .status-badge {
                border: none !important;
                background: none !important;
                padding: 0 !important;
                font-weight: normal !important;
                color: black !important;
            }

            /* ส่วนลงนามท้ายกระดาษ */
            .signature-section {
                justify-content: space-between;
                margin-top: 60px;
                page-break-inside: avoid;
            }
            .signature-box {
                text-align: center;
                width: 40%;
            }
            .signature-line {
                border-bottom: 1px dotted black;
                width: 80%;
                margin: 30px auto 10px auto;
                height: 1px;
            }
        }

        /* ซ่อนส่วนที่ใช้เฉพาะตอนพิมพ์ในหน้าจอปกติ */
        .print-header-official { display: none; }
        .print-summary-official { display: none; }
        .signature-section { display: none; }
        
        /* Hide Scrollbar */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Home, PlusCircle, ClipboardList, CheckCircle, User, ShieldCheck, Filter, 
            Check, X, ArrowLeft, HeartHandshake, MapPin, Phone, Calendar, BookOpen, 
            Menu, ChevronRight, Download, Printer, Lock, LogOut, FileText, Megaphone, 
            Mic, RotateCcw, CalendarDays, Pencil, Save, Key, QrCode, ShoppingBag, 
            UploadCloud, Image as ImageIcon, Loader, Info, Settings, Trash2, AlertTriangle, 
            Plus, LogIn, Facebook, MessageCircle, Palette, Bell, FileCheck, Type, Newspaper, Edit, Layout,
            Search, SlidersHorizontal
        } from 'lucide-react';
        import { initializeApp } from "firebase/app";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken,
            onAuthStateChanged
        } from "firebase/auth";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            updateDoc, 
            doc, 
            onSnapshot, 
            query,
            setDoc,
            deleteDoc,
            getDocs,
            writeBatch
        } from "firebase/firestore";

        // ==========================================
        // 1. FIREBASE CONFIG
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAHuvRRTNpYuh8MFiIwN4Lm106l09BED14",
            authDomain: "donation-1b152.firebaseapp.com",
            projectId: "donation-1b152",
            storageBucket: "donation-1b152.firebasestorage.app",
            messagingSenderId: "203853712269",
            appId: "1:203853712269:web:80441cd834e7b0e68dcbc4",
            measurementId: "G-10ZKFX0TET"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ==========================================
        // 2. CONSTANTS
        // ==========================================
        const DEFAULT_SETTINGS = {
            systemStatus: 'open', 
            templeName: 'วัดไชยามาตย์',
            themeColor: 'orange', 
            fontFamily: 'Prompt', 
            bannerUrl: 'https://images.unsplash.com/photo-1590484501469-808ceea194f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80',
            qrCodeUrl: 'https://img2.pic.in.th/pic/099400240646898.png',
            marqueeText: 'ขอเชิญร่วมทำบุญตามกำลังศรัทธา... สะสมบุญ นำสุขมาให้',
            requireSlip: true,
            about: {
                title: "ประวัติและข้อมูล",
                heading: "ความร่มเย็นแห่งล้านนา",
                highlightWord: "ล้านนา",
                content: "วัดไชยามาตย์ ตั้งอยู่ที่ตำบลเวียงทอง อำเภอสูงเม่น จังหวัดแพร่...",
                imageUrl: "https://images.unsplash.com/photo-1579548231964-b0a701fccf23?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
            },
            passwords: { staff: '104', admin: 'admin104' },
            bankInfo: { bankName: 'ธ.กรุงไทย', accountName: 'วัดไชยามาตย์', accountNumber: 'xxx-x-xxxxx-x' },
            contact: { phone: '082-2801992', address: 'หมู่ที่ 1 ตำบลเวียงทอง อำเภอสูงเม่น จังหวัดแพร่ 54130', facebook: '', line: '' },
            messages: { thankYou: 'ขออนุโมทนาบุญ...' },
            donationTypes: [
                { id: 'general', name: 'บริจาคทั่วไป / ค่าน้ำค่าไฟ', hasQuantity: false, price: 0, active: true },
                { id: 'thai_taan', name: 'ไทยทาน', hasQuantity: true, price: 300, unit: 'ชุด', active: true },
                { id: 'hua_wat', name: 'หัววัด', hasQuantity: true, price: 500, unit: 'ชุด', active: true },
                { id: 'roong_taan', name: 'จองโรงทาน', isSpecial: true, active: true } 
            ]
        };

        const FONT_OPTIONS = [
            { id: 'Sarabun', name: 'Sarabun (ทางการ)' },
            { id: 'Prompt', name: 'Prompt (ทันสมัย)' },
            { id: 'Kanit', name: 'Kanit (ยอดนิยม)' },
            { id: 'Mitr', name: 'Mitr (เป็นมิตร)' },
            { id: 'Mali', name: 'Mali (ลายมือ)' },
        ];

        // ==========================================
        // 3. UTILITIES
        // ==========================================
        const resizeImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 800;
                        const scaleSize = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        };

        const NotificationToast = ({ msg, onClose, type = 'success' }) => {
            if (!msg) return null;
            const bgColor = type === 'success' ? 'bg-green-100 border-green-500 text-green-800' : 'bg-red-100 border-red-500 text-red-800';
            return (
                <div className={`fixed top-4 right-4 z-[100] flex items-center p-4 mb-4 rounded-lg border-l-4 shadow-lg animate-bounce-in ${bgColor}`}>
                    <div className="text-sm font-medium">{msg}</div>
                    <button onClick={onClose} className="ml-4 hover:opacity-70"><X className="w-4 h-4" /></button>
                </div>
            );
        };

        const PowerIcon = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
        );

        // ==========================================
        // 4. MODALS & SUB-COMPONENTS
        // ==========================================
        function LoginModal({ role, onClose, onLoginSuccess, settings }) {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const staffPass = settings?.passwords?.staff || '104';
            const adminPass = settings?.passwords?.admin || 'admin104';

            const handleSubmit = (e) => { 
                e.preventDefault(); 
                if (role === 'staff' && password === staffPass) { onLoginSuccess(); } 
                else if (role === 'admin' && password === adminPass) { onLoginSuccess(); } 
                else { setError('รหัสผ่านไม่ถูกต้อง'); }
            };

            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-sm w-full p-6 animate-scale-up">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-bold text-gray-900 flex items-center"><Lock className="w-5 h-5 mr-2 text-orange-600" /> เข้าสู่ระบบ ({role})</h3>
                            <button onClick={onClose}><X className="w-5 h-5 text-gray-400" /></button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-1">รหัสผ่าน</label>
                                <input type="password" className="w-full p-2 border border-gray-300 rounded outline-none focus:border-orange-500" value={password} onChange={(e) => setPassword(e.target.value)} autoFocus />
                                {error && <p className="text-red-500 text-xs mt-1">{error}</p>}
                            </div>
                            <button type="submit" className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 rounded transition-colors">ยืนยัน</button>
                        </form>
                    </div>
                </div>
            );
        }

        function EditModal({ donation, userRole, onClose, onSave, showNotification }) {
            const [formData, setFormData] = useState({ ...donation });
            const [securityCode, setSecurityCode] = useState('');
            const [error, setError] = useState('');
            
            const handleSave = () => {
                if (!formData.name) return setError('กรุณาระบุชื่อ-สกุล');
                if (!formData.amount || formData.amount < 0) return setError('จำนวนเงินไม่ถูกต้อง');
                if (userRole === 'staff' && securityCode !== '104') return setError('รหัสลับความปลอดภัยไม่ถูกต้อง');
                onSave(formData); 
                onClose();
            };

            const dateStr = formData.dateTime ? new Date(formData.dateTime).toLocaleString('th-TH') : '-';

            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 animate-scale-up max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-6 pb-2 border-b"><h3 className="text-xl font-bold text-gray-900 flex items-center"><Pencil className="w-5 h-5 mr-2 text-orange-600" /> แก้ไขข้อมูลบริจาค</h3><button onClick={onClose}><X className="w-5 h-5 text-gray-400" /></button></div>
                        <div className="space-y-4">
                            <div className="bg-gray-50 p-2 rounded text-sm text-gray-500">ID: {formData.id}</div>
                            <div className="grid grid-cols-2 gap-4"><div><label className="block text-xs font-medium text-gray-500 mb-1">วัน-เวลา</label><input type="text" disabled className="w-full p-1 border border-gray-300 rounded text-sm bg-gray-100" value={dateStr} /></div></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">ชื่อ - สกุล</label><input type="text" className="w-full p-2 border border-gray-300 rounded outline-none" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} /></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">รายการที่บริจาค</label><input type="text" className="w-full p-2 border border-gray-300 rounded outline-none" value={formData.purpose} onChange={e => setFormData({...formData, purpose: e.target.value})} /></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">จำนวนเงิน (บาท)</label><input type="number" className="w-full p-2 border border-gray-300 rounded outline-none font-bold text-orange-600" value={formData.amount} onChange={e => setFormData({...formData, amount: parseFloat(e.target.value)})} /></div>
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">ช่องทาง</label><select className="w-full p-2 border border-gray-300 rounded outline-none bg-white" value={formData.method} onChange={e => setFormData({...formData, method: e.target.value})}><option value="เงินโอน">เงินโอน</option><option value="เงินสด">เงินสด</option><option value="อื่นๆ">อื่นๆ</option></select></div>
                            </div>
                            {formData.slipImage && (<div className="mt-2"><label className="block text-sm font-medium text-gray-700 mb-1">สลิปที่แนบมา</label><img src={formData.slipImage} alt="Slip" className="max-h-40 border rounded" /></div>)}
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">สถานะ</label><select className="w-full p-2 border border-gray-300 rounded outline-none bg-white" value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}><option value="pending">รอตรวจสอบ</option><option value="approved">อนุมัติแล้ว</option><option value="rejected">ปฏิเสธ</option></select></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">หมายเหตุเพิ่มเติม</label><textarea rows="2" className="w-full p-2 border border-gray-300 rounded outline-none" value={formData.generalNote || ''} onChange={e => setFormData({...formData, generalNote: e.target.value})} /></div>
                            <hr className="my-4 border-gray-200" />
                            {userRole === 'staff' && (<div className="bg-red-50 border border-red-200 p-4 rounded-lg"><label className="block text-sm font-bold text-red-700 mb-2 flex items-center"><Key className="w-4 h-4 mr-2" /> ระบุรหัสลับความปลอดภัย</label><input type="password" placeholder="รหัสลับ (104)" className="w-full p-2 border border-red-300 rounded outline-none focus:ring-2 focus:ring-red-500" value={securityCode} onChange={e => setSecurityCode(e.target.value)} /><p className="text-xs text-red-500 mt-1">* ต้องใส่รหัสลับทุกครั้งเมื่อแก้ไขยอดเงิน</p></div>)}
                            {error && <div className="text-red-600 text-sm font-medium bg-red-50 p-2 rounded text-center">{error}</div>}
                            <button onClick={handleSave} className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-lg flex items-center justify-center transition"><Save className="w-5 h-5 mr-2" /> บันทึกการแก้ไข</button>
                        </div>
                    </div>
                </div>
            );
        }

        // ==========================================
        // 5. PANELS & MANAGERS
        // ==========================================
        function NewsManager({ showNotification }) {
            const [newsList, setNewsList] = useState([]);
            const [isEditing, setIsEditing] = useState(false);
            const [formData, setFormData] = useState({ title: '', content: '', date: '', images: [] });
            const [editingId, setEditingId] = useState(null);
            const [isUploading, setIsUploading] = useState(false);

            useEffect(() => {
                const q = query(collection(db, 'news'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    docs.forEach(doc => { if (doc.imageUrl && (!doc.images || doc.images.length === 0)) doc.images = [doc.imageUrl]; });
                    docs.sort((a, b) => new Date(b.date) - new Date(a.date));
                    setNewsList(docs);
                });
                return () => unsubscribe();
            }, []);

            const handleImageUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    setIsUploading(true);
                    try {
                        const newImages = await Promise.all(files.map(file => resizeImage(file)));
                        setFormData(prev => ({ ...prev, images: [...(prev.images || []), ...newImages] }));
                    } catch (err) { showNotification("อัปโหลดรูปไม่สำเร็จ", "error"); }
                    setIsUploading(false);
                }
            };
            const removeImage = (indexToRemove) => { setFormData(prev => ({ ...prev, images: prev.images.filter((_, index) => index !== indexToRemove) })); };
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.title || !formData.date) return showNotification("กรุณาระบุหัวข้อและวันที่", "error");
                try {
                    const dataToSave = { ...formData, imageUrl: formData.images?.[0] || '' };
                    if (editingId) { await updateDoc(doc(db, 'news', editingId), dataToSave); showNotification("แก้ไขข่าวสารสำเร็จ"); } 
                    else { await addDoc(collection(db, 'news'), { ...dataToSave, createdAt: new Date().toISOString() }); showNotification("เพิ่มข่าวสารสำเร็จ"); }
                    setIsEditing(false); setFormData({ title: '', content: '', date: '', images: [] }); setEditingId(null);
                } catch (error) { showNotification("เกิดข้อผิดพลาด: " + error.message, "error"); }
            };
            const handleDelete = async (id) => { if (confirm("ยืนยันการลบข่าวสารนี้?")) { try { await deleteDoc(doc(db, 'news', id)); showNotification("ลบข่าวสารเรียบร้อย"); } catch (error) { showNotification("ลบไม่สำเร็จ", "error"); } } };
            const startEdit = (news) => { setFormData({ title: news.title, content: news.content, date: news.date, images: news.images || (news.imageUrl ? [news.imageUrl] : []) }); setEditingId(news.id); setIsEditing(true); };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center mb-4"><h2 className="text-xl font-bold flex items-center text-gray-800"><Newspaper className="w-6 h-6 mr-2 text-blue-600" /> จัดการข่าวสารและกิจกรรม</h2>{!isEditing && (<button onClick={() => { setIsEditing(true); setFormData({ title: '', content: '', date: new Date().toISOString().split('T')[0], images: [] }); setEditingId(null); }} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center"><Plus className="w-4 h-4 mr-2" /> เพิ่มข่าวใหม่</button>)}</div>
                    {isEditing ? (
                        <div className="bg-white p-6 rounded-xl shadow border border-blue-100 animate-fade-in"><h3 className="text-lg font-bold mb-4">{editingId ? 'แก้ไขข่าวสาร' : 'เพิ่มข่าวสารใหม่'}</h3><form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-sm font-medium mb-1">หัวข้อข่าว *</label><input type="text" className="w-full p-2 border rounded" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} required /></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label className="block text-sm font-medium mb-1">วันที่กิจกรรม *</label><input type="date" className="w-full p-2 border rounded" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} required /></div><div><label className="block text-sm font-medium mb-1">รูปภาพประกอบ (เลือกได้หลายรูป)</label><div className="flex gap-2 items-center"><label className="cursor-pointer bg-gray-100 px-4 py-2 rounded border hover:bg-gray-200 text-sm flex items-center">{isUploading ? <Loader className="w-4 h-4 animate-spin mr-2" /> : <UploadCloud className="w-4 h-4 mr-2" />}{isUploading ? 'กำลังประมวลผล...' : 'เพิ่มรูปภาพ'}<input type="file" className="hidden" accept="image/*" multiple onChange={handleImageUpload} disabled={isUploading} /></label><span className="text-xs text-gray-500">{formData.images?.length || 0} รูป</span></div></div></div>{formData.images && formData.images.length > 0 && (<div className="grid grid-cols-3 sm:grid-cols-4 gap-2 mt-2">{formData.images.map((img, idx) => (<div key={idx} className="relative aspect-square bg-gray-100 rounded border overflow-hidden group"><img src={img} className="w-full h-full object-cover" alt={`preview ${idx}`} /><button type="button" onClick={() => removeImage(idx)} className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow-md hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-opacity"><X className="w-3 h-3" /></button>{idx === 0 && <span className="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-[10px] text-center py-0.5">ภาพปก</span>}</div>))}</div>)}<div><label className="block text-sm font-medium mb-1">เนื้อหาข่าว / รายละเอียด</label><textarea rows="5" className="w-full p-2 border rounded" value={formData.content} onChange={e => setFormData({...formData, content: e.target.value})}></textarea></div><div className="flex gap-2 pt-2"><button type="button" onClick={() => setIsEditing(false)} className="px-4 py-2 border rounded hover:bg-gray-50">ยกเลิก</button><button type="submit" disabled={isUploading} className={`px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 ${isUploading ? 'opacity-50 cursor-not-allowed' : ''}`}>บันทึก</button></div></form></div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{newsList.map(news => { const coverImage = (news.images && news.images.length > 0) ? news.images[0] : news.imageUrl; return (<div key={news.id} className="bg-white rounded-xl shadow overflow-hidden group border hover:border-blue-300 transition"><div className="h-48 bg-gray-200 relative overflow-hidden">{coverImage ? (<img src={coverImage} alt={news.title} className="w-full h-full object-cover group-hover:scale-105 transition duration-500" />) : (<div className="flex items-center justify-center h-full text-gray-400"><ImageIcon className="w-10 h-10" /></div>)}{news.images && news.images.length > 1 && (<div className="absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-md">+{news.images.length - 1} รูป</div>)}<div className="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition"><button onClick={() => startEdit(news)} className="bg-white p-2 rounded-full shadow hover:text-blue-600"><Edit className="w-4 h-4" /></button><button onClick={() => handleDelete(news.id)} className="bg-white p-2 rounded-full shadow hover:text-red-600"><Trash2 className="w-4 h-4" /></button></div></div><div className="p-4"><div className="text-xs text-gray-500 mb-1">{new Date(news.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</div><h3 className="font-bold text-lg mb-2 line-clamp-2">{news.title}</h3><p className="text-gray-600 text-sm line-clamp-3">{news.content}</p></div></div>); })}{newsList.length === 0 && (<div className="col-span-full text-center py-10 text-gray-500 bg-gray-50 rounded-xl border border-dashed">ยังไม่มีข่าวสาร</div>)}</div>
                    )}
                </div>
            );
        }

        function DonationForm({ userRole, onSave, showNotification, settings }) {
            const [name, setName] = useState('');
            const [method, setMethod] = useState((userRole === 'staff' || userRole === 'admin') ? 'เงินสด' : 'เงินโอน');
            const [generalNote, setGeneralNote] = useState('');
            const [slipImage, setSlipImage] = useState(null); 
            const [isUploading, setIsUploading] = useState(false);
            const [showThankYou, setShowThankYou] = useState(false);
            const [selectedItems, setSelectedItems] = useState({});
            const theme = settings.themeColor || 'orange';
            const donationTypes = settings.donationTypes || [];

            useEffect(() => {
                const initial = {};
                donationTypes.forEach(type => {
                    if (type.active) {
                        initial[type.id] = { checked: false, quantity: 1, amount: type.price || '' };
                    }
                });
                const roongTaan = donationTypes.find(t => t.id === 'roong_taan');
                if (roongTaan && roongTaan.active) {
                    initial['roong_taan'] = { checked: false, date: '', note: '' };
                }
                setSelectedItems(prev => ({...initial, ...prev}));
            }, [donationTypes]);

            useEffect(() => {
                if (userRole === 'staff' || userRole === 'admin') {
                    setMethod('เงินสด');
                } else {
                    setMethod('เงินโอน');
                }
            }, [userRole]);

            const totalAmount = useMemo(() => {
                let sum = 0;
                donationTypes.forEach(type => {
                    if (selectedItems[type.id]?.checked && !type.isSpecial) {
                        if (type.hasQuantity) {
                            sum += (selectedItems[type.id].quantity || 1) * type.price;
                        } else {
                            sum += Number(selectedItems[type.id].amount || 0);
                        }
                    }
                });
                return sum;
            }, [selectedItems, donationTypes]);

            const handleFileChange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    setIsUploading(true);
                    try { const resized = await resizeImage(file); setSlipImage(resized); } catch (err) { showNotification("ไม่สามารถอ่านไฟล์ภาพได้", 'error'); }
                    setIsUploading(false);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (settings.systemStatus === 'closed') return showNotification('ขณะนี้ปิดรับบริจาคชั่วคราว', 'error');
                if (!name) return showNotification('กรุณาระบุชื่อ-สกุล', 'error');
                
                const isRoongTaanChecked = selectedItems['roong_taan']?.checked;
                if (totalAmount <= 0 && !isRoongTaanChecked) return showNotification('กรุณาระบุยอดเงินบริจาค', 'error');
                if (isRoongTaanChecked && (!selectedItems['roong_taan'].date || !selectedItems['roong_taan'].note)) return showNotification('กรุณาระบุวันที่และสิ่งของสำหรับโรงทาน', 'error');
                if (settings.requireSlip !== false && method === 'เงินโอน' && !slipImage && userRole === 'donor') return showNotification('กรุณาแนบสลิปการโอนเงิน', 'error');

                let purposeParts = [];
                donationTypes.forEach(type => {
                    const item = selectedItems[type.id];
                    if (item?.checked) {
                        if (type.isSpecial && type.id === 'roong_taan') {
                            purposeParts.push(`จองโรงทาน`);
                        } else if (type.hasQuantity) {
                            purposeParts.push(`${type.name} ${item.quantity} ${type.unit} (${(item.quantity * type.price).toLocaleString()} บาท)`);
                        } else {
                            purposeParts.push(`${type.name} ${Number(item.amount).toLocaleString()} บาท`);
                        }
                    }
                });

                const newDonation = { 
                    dateTime: new Date().toISOString(), name, purpose: purposeParts.join(', '), amount: totalAmount, method, generalNote, status: userRole === 'donor' ? 'pending' : 'approved', source: userRole === 'donor' ? 'self' : 'staff', announced: false, roongTaanDate: isRoongTaanChecked ? selectedItems['roong_taan'].date : null, roongTaanNote: isRoongTaanChecked ? selectedItems['roong_taan'].note : null, slipImage: slipImage 
                };
                onSave(newDonation);
                if (userRole === 'donor') setShowThankYou(true); else resetForm();
            };

            const resetForm = () => {
                setName(''); setMethod((userRole === 'staff' || userRole === 'admin') ? 'เงินสด' : 'เงินโอน'); setGeneralNote(''); setSlipImage(null);
                const resetItems = {};
                Object.keys(selectedItems).forEach(key => {
                    resetItems[key] = { ...selectedItems[key], checked: false, amount: '', quantity: 1, date: '', note: '' };
                });
                setSelectedItems(resetItems);
                setShowThankYou(false);
            }

            if (showThankYou) {
                return (
                    <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-8 text-center animate-scale-up">
                        <div className={`w-20 h-20 bg-${theme}-100 rounded-full flex items-center justify-center mx-auto mb-6`}><HeartHandshake className={`w-10 h-10 text-${theme}-600`} /></div>
                        <h2 className={`text-2xl font-bold text-${theme}-700 mb-4`}>อนุโมทนาบุญ</h2>
                        <p className="text-gray-600 text-lg leading-relaxed mb-8">{settings.messages?.thankYou || 'ขอขอบคุณที่ร่วมทำบุญ'}</p>
                        <button onClick={resetForm} className={`bg-${theme}-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-${theme}-700 transition`}>กลับสู่หน้าหลัก</button>
                    </div>
                );
            }

            if (settings.systemStatus === 'closed' && userRole === 'donor') {
                return (
                    <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-8 text-center text-red-600">
                        <AlertTriangle className="w-16 h-16 mx-auto mb-4" />
                        <h2 className="text-2xl font-bold">ขณะนี้ปิดรับบริจาคชั่วคราว</h2>
                    </div>
                );
            }

            return (
                <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-md overflow-hidden no-print">
                    <div className={`bg-${theme}-100 px-6 py-4 border-b border-${theme}-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2`}>
                        <h2 className={`text-xl font-semibold text-${theme}-800 flex items-center`}><PlusCircle className="w-6 h-6 mr-2 shrink-0" /> {userRole === 'donor' ? 'ฟอร์มแจ้งความประสงค์บริจาค' : 'บันทึกรับเงินบริจาค'}</h2>
                        <span className="text-xs sm:text-sm text-gray-500 bg-white px-3 py-1 rounded-full border">{userRole === 'donor' ? 'รอตรวจสอบ' : 'อนุมัติอัตโนมัติ'}</span>
                    </div>
                    <form onSubmit={handleSubmit} className="p-6 space-y-6">
                        <div className="grid grid-cols-2 gap-4 text-sm text-gray-500 bg-gray-50 p-3 rounded-lg border"><div><span className="font-semibold">ID:</span> อัตโนมัติ</div><div><span className="font-semibold">วันเวลา:</span> {new Date().toLocaleString('th-TH')}</div></div>
                        <div><label className="block text-sm font-medium text-gray-700 mb-1">ชื่อ - สกุล ผู้บริจาค <span className="text-red-500">*</span></label><input type="text" required className={`w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-${theme}-500 outline-none`} value={name} onChange={e => setName(e.target.value)} placeholder="เช่น นายบุญเรือง จิตใส" /></div>
                        <div className="space-y-3">
                            <label className="block text-sm font-medium text-gray-700">เลือกประเภทการบริจาค</label>
                            {donationTypes.filter(t => t.active).map(type => {
                                const itemState = selectedItems[type.id] || { checked: false, quantity: 1, amount: '' };
                                const isChecked = itemState.checked;
                                if (type.isSpecial && type.id === 'roong_taan') {
                                    return (
                                        <div key={type.id} className={`p-3 rounded-lg border transition-colors ${isChecked ? `bg-${theme}-50 border-${theme}-300` : 'border-gray-200 hover:bg-gray-50'}`}>
                                            <div className="flex items-center mb-2"><input type="checkbox" className={`w-5 h-5 text-${theme}-600 rounded border-gray-300 focus:ring-${theme}-500`} checked={isChecked} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...itemState, checked: e.target.checked}})} /><span className="ml-2 font-medium">{type.name}</span></div>
                                            {isChecked && (<div className="ml-7 space-y-2"><input type="date" className="w-full p-2 border border-gray-300 rounded outline-none text-sm" value={itemState.date || ''} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...itemState, date: e.target.value}})} required /><input type="text" placeholder="ระบุสิ่งของ" className="w-full p-2 border border-gray-300 rounded outline-none text-sm" value={itemState.note || ''} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...itemState, note: e.target.value}})} required /></div>)}
                                        </div>
                                    );
                                }
                                return (
                                    <div key={type.id} className={`p-3 rounded-lg border transition-colors ${isChecked ? `bg-${theme}-50 border-${theme}-300` : 'border-gray-200 hover:bg-gray-50'}`}>
                                        <div className="flex items-center mb-2 justify-between">
                                            <div className="flex items-center"><input type="checkbox" className={`w-5 h-5 text-${theme}-600 rounded border-gray-300 focus:ring-${theme}-500`} checked={isChecked} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...itemState, checked: e.target.checked}})} /><span className="ml-2 font-medium">{type.name} {type.hasQuantity && `(${type.price}.-)`}</span></div>
                                            {isChecked && type.hasQuantity && <span className={`text-${theme}-600 font-bold`}>{itemState.quantity * type.price} บ.</span>}
                                        </div>
                                        {isChecked && (<div className="ml-7 flex items-center gap-2">{type.hasQuantity ? (<><button type="button" className="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300" onClick={() => setSelectedItems(prev => ({...prev, [type.id]: {...itemState, quantity: Math.max(1, (itemState.quantity || 1) - 1)}}))}>-</button><input type="number" min="1" className="w-16 text-center border-none bg-transparent font-bold" value={itemState.quantity || 1} readOnly /><button type="button" className="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300" onClick={() => setSelectedItems(prev => ({...prev, [type.id]: {...itemState, quantity: (itemState.quantity || 1) + 1}}))}>+</button><span className="text-gray-500">{type.unit}</span></>) : (<><input type="number" min="1" placeholder="ระบุจำนวนเงิน" className="w-full p-2 border border-gray-300 rounded outline-none" value={itemState.amount} onChange={e => setSelectedItems({...selectedItems, [type.id]: {...itemState, amount: e.target.value}})} /><span className="text-gray-500">บาท</span></>)}</div>)}
                                    </div>
                                );
                            })}
                        </div>
                        <div className={`bg-${theme}-50 p-4 rounded-xl flex justify-between items-center border border-${theme}-100`}><span className="text-gray-700 font-semibold">ยอดรวมทั้งสิ้น</span><span className={`text-2xl font-bold text-${theme}-600`}>{totalAmount.toLocaleString()} บาท</span></div>
                        <div><label className="block text-sm font-medium text-gray-700 mb-1">ช่องทางการบริจาค</label><select className="w-full p-2 border border-gray-300 rounded outline-none bg-white" value={method} onChange={e => setMethod(e.target.value)}><option value="เงินโอน">โอนเงินเข้าบัญชีวัด</option><option value="เงินสด">เงินสด</option><option value="อื่นๆ">อื่นๆ</option></select></div>
                        <div className="bg-gray-50 rounded-lg border border-gray-200 p-4">
                            {(userRole === 'staff' || userRole === 'admin') ? (<div className="flex items-center justify-center text-green-600 gap-2 py-2"><CheckCircle className="w-5 h-5" /><span className="font-medium">เจ้าหน้าที่บันทึก: ยืนยันการรับเงินแล้ว</span></div>) : method === 'เงินโอน' ? (
                                <div className="space-y-4 text-center">
                                    <div className="animate-fade-in"><p className="text-sm font-bold text-gray-700 mb-2">1. สแกน QR Code เพื่อโอนเงิน</p><div className="bg-white p-3 rounded-lg shadow-sm border inline-block"><img src={settings.qrCodeUrl} alt="QR Code" className="w-40 h-40 object-contain" /></div><p className="text-xs text-gray-500 mt-1">{settings.bankInfo?.bankName} | {settings.bankInfo?.accountName}</p><p className={`text-lg font-mono font-bold text-${theme}-700 mt-1 select-all`}>{settings.bankInfo?.accountNumber}</p></div>
                                    <div className="border-t border-gray-200 pt-4"><p className="text-sm font-bold text-gray-700 mb-2">{settings.requireSlip !== false ? '2. แนบหลักฐานการโอน *' : '2. แนบหลักฐานการโอน (ถ้ามี)'}</p><label className="cursor-pointer block border-2 border-dashed border-gray-300 rounded-lg p-4 hover:bg-gray-100 transition"><div className="flex flex-col items-center justify-center">{isUploading ? <Loader className="w-6 h-6 animate-spin text-gray-400" /> : <UploadCloud className="w-6 h-6 text-gray-400 mb-1" />}<span className="text-sm text-gray-600">{slipImage ? 'เปลี่ยนรูปสลิป' : 'คลิกเพื่อเลือกรูปสลิป'}</span></div><input type="file" accept="image/*" className="hidden" onChange={handleFileChange} /></label>{slipImage && (<div className="mt-3 relative inline-block"><img src={slipImage} alt="Preview" className="h-24 object-contain rounded border bg-white" /><button type="button" onClick={() => setSlipImage(null)} className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600"><X className="w-3 h-3" /></button></div>)}</div>
                                </div>
                            ) : (<div className="flex flex-col items-center justify-center text-gray-500 py-4"><ShoppingBag className="w-12 h-12 mb-2 opacity-30" /><p className="text-sm">กรุณานำเงินสดมาบริจาคที่จุดรับบริจาค</p></div>)}
                        </div>
                        <div><label className="block text-sm font-medium text-gray-700 mb-1">หมายเหตุเพิ่มเติม</label><textarea rows="2" className="w-full p-2 border border-gray-300 rounded outline-none" value={generalNote} onChange={e => setGeneralNote(e.target.value)} placeholder="ข้อความเพิ่มเติม..."></textarea></div>
                        <button type="submit" disabled={isUploading} className={`w-full text-white font-bold py-3 px-4 rounded hover:bg-${theme}-700 transition shadow-lg flex justify-center items-center text-lg ${isUploading ? 'bg-gray-400' : `bg-${theme}-600`}`}>{isUploading ? 'กำลังประมวลผลรูป...' : <><CheckCircle className="w-6 h-6 mr-2 shrink-0" /> ยืนยันการบริจาค</>}</button>
                    </form>
                </div>
            );
        }

        function Dashboard({ donations, userRole, onUpdateDonation, showNotification, settings }) {
            const [editingDonation, setEditingDonation] = useState(null);
            const [viewSlip, setViewSlip] = useState(null);
            
            // Filtering States
            const [filterDate, setFilterDate] = useState('');
            const [filterMethod, setFilterMethod] = useState('all');
            const [filterType, setFilterType] = useState('all');

            // Apply Filters
            const filteredData = donations.filter(d => {
                let isValid = true;
                
                // Date Filter
                if (filterDate) {
                    const dDate = new Date(d.dateTime).toLocaleDateString('en-CA'); // YYYY-MM-DD
                    if (dDate !== filterDate) isValid = false;
                }

                // Method Filter
                if (filterMethod !== 'all') {
                    if (d.method !== filterMethod) isValid = false;
                }

                // Type Filter
                if (filterType !== 'all') {
                    if (filterType === 'roong_taan') {
                        if (!d.roongTaanDate && !d.purpose.includes('โรงทาน')) isValid = false;
                    } else if (filterType === 'thai_taan') {
                        if (!d.purpose.includes('ไทยทาน')) isValid = false;
                    } else if (filterType === 'hua_wat') {
                        if (!d.purpose.includes('หัววัด')) isValid = false;
                    } else if (filterType === 'general') {
                        if (d.roongTaanDate || d.purpose.includes('ไทยทาน') || d.purpose.includes('หัววัด')) isValid = false;
                    }
                }

                return isValid;
            });

            const totalAmount = filteredData.reduce((sum, d) => d.status === 'approved' ? sum + (Number(d.amount) || 0) : sum, 0);
            
            const exportCSV = () => {
                const headers = ["ID", "Date", "Name", "Purpose", "Amount", "Method", "Status", "Note"];
                const rows = filteredData.map(d => [d.id, d.dateTime ? new Date(d.dateTime).toLocaleString('th-TH') : '-', `"${d.name}"`, `"${d.purpose}"`, d.amount, d.method, d.status, `"${d.generalNote || ''}"`]);
                const csvContent = "data:text/csv;charset=utf-8,\uFEFF" + [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
                const link = document.createElement("a");
                link.setAttribute("href", encodeURI(csvContent));
                link.setAttribute("download", `donation_report_${filterDate || 'all'}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const resetFilters = () => {
                setFilterDate('');
                setFilterMethod('all');
                setFilterType('all');
            };

            // Format date for display in header
            const printDateDisplay = filterDate 
                ? new Date(filterDate).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })
                : "ข้อมูลทั้งหมด";

            return (
                <div className="space-y-6">
                    {editingDonation && (<EditModal donation={editingDonation} userRole={userRole} onClose={() => setEditingDonation(null)} onSave={onUpdateDonation} showNotification={showNotification} />)}
                    {viewSlip && (<div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={() => setViewSlip(null)}><div className="relative max-w-3xl max-h-full"><img src={viewSlip} alt="Full Slip" className="max-w-full max-h-[90vh] rounded shadow-lg" /><button className="absolute -top-4 -right-4 bg-white rounded-full p-2 shadow" onClick={() => setViewSlip(null)}><X className="w-6 h-6" /></button></div></div>)}
                    
                    {/* Header & Tools */}
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4 no-print">
                        <h2 className="text-xl sm:text-2xl font-bold text-gray-800 flex items-center"><ClipboardList className="w-6 h-6 mr-2 text-orange-600" /> สรุปยอดและรายงาน</h2>
                        <div className="flex gap-2 w-full sm:w-auto">
                            <button onClick={() => window.print()} className="flex-1 sm:flex-none flex items-center justify-center bg-gray-800 hover:bg-gray-900 text-white px-4 py-2 rounded text-sm transition-colors shadow"><Printer className="w-4 h-4 mr-2" /> พิมพ์เอกสาร (ทางการ)</button>
                            <button onClick={exportCSV} className="flex-1 sm:flex-none flex items-center justify-center bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm transition-colors"><FileText className="w-4 h-4 mr-2" /> CSV / Excel</button>
                        </div>
                    </div>

                    {/* Filter Bar */}
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200 no-print">
                        <div className="flex items-center gap-2 mb-2 text-sm font-medium text-gray-700"><SlidersHorizontal className="w-4 h-4" /> ตัวกรองข้อมูล</div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">วันที่</label>
                                <input type="date" className="w-full p-2 border rounded text-sm" value={filterDate} onChange={(e) => setFilterDate(e.target.value)} />
                            </div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">ช่องทางการเงิน</label>
                                <select className="w-full p-2 border rounded text-sm" value={filterMethod} onChange={(e) => setFilterMethod(e.target.value)}>
                                    <option value="all">ทั้งหมด</option>
                                    <option value="เงินสด">เฉพาะเงินสด</option>
                                    <option value="เงินโอน">เฉพาะเงินโอน</option>
                                    <option value="อื่นๆ">อื่นๆ</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">ประเภทรายการ</label>
                                <select className="w-full p-2 border rounded text-sm" value={filterType} onChange={(e) => setFilterType(e.target.value)}>
                                    <option value="all">ทั้งหมด</option>
                                    <option value="general">บริจาคทั่วไป / ค่าน้ำไฟ</option>
                                    <option value="thai_taan">ไทยทาน</option>
                                    <option value="hua_wat">หัววัด</option>
                                    <option value="roong_taan">โรงทาน</option>
                                </select>
                            </div>
                            <div className="flex items-end">
                                <button onClick={resetFilters} className="w-full p-2 bg-gray-100 text-gray-600 rounded text-sm hover:bg-gray-200 transition">ล้างตัวกรอง</button>
                            </div>
                        </div>
                    </div>
                    
                    {/* WRAPPED IN PRINT-CONTAINER */}
                    <div className="print-container">
                        
                        {/* OFFICIAL HEADER (Print Only) */}
                        <div className="print-header-official text-center mb-6">
                            <div className="mb-4">
                                <img src="https://img2.pic.in.th/pic/-Ver.3-1.png" alt="Logo" style={{ height: '100px', display: 'inline-block' }} />
                            </div>
                            <h1 className="text-2xl font-bold mb-1">บันทึกรายงานสรุปยอดบริจาค</h1>
                            <h2 className="text-xl font-bold mb-1">{settings.templeName}</h2>
                            <p className="text-sm">{settings.contact?.address}</p>
                            <div className="flex justify-between items-end mt-4 border-b border-black pb-2">
                                <div className="text-sm text-left">
                                    <strong>สิ่งที่ส่งมาด้วย:</strong> รายละเอียดการรับบริจาค<br/>
                                    <strong>ช่วงเวลาข้อมูล:</strong> {printDateDisplay}
                                </div>
                                <div className="text-sm text-right">
                                    <strong>วันที่พิมพ์:</strong> {new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}<br/>
                                    <strong>เวลา:</strong> {new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})} น.
                                </div>
                            </div>
                        </div>

                        {/* Summary Cards (Screen Only) */}
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6 screen-only">
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-orange-100 text-center col-span-2 md:col-span-1"><span className="text-xs sm:text-sm font-medium text-gray-500 block mb-1">ยอดรวม (ตามตัวกรอง)</span><span className="text-2xl sm:text-3xl font-bold text-green-600">{totalAmount.toLocaleString()} ฿</span></div>
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-orange-100 text-center"><span className="text-xs sm:text-sm font-medium text-gray-500 block mb-1">จำนวนรายการ</span><span className="text-2xl sm:text-3xl font-bold text-blue-600">{filteredData.length}</span></div>
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-orange-100 text-center"><span className="text-xs sm:text-sm font-medium text-gray-500 block mb-1">รอตรวจ</span><span className="text-2xl sm:text-3xl font-bold text-orange-500">{filteredData.filter(d=>d.status==='pending').length}</span></div>
                        </div>

                        {/* Official Summary (Print Only) */}
                        <div className="print-summary-official mb-4 p-4 border border-black">
                            <h3 className="font-bold border-b border-black mb-2 pb-1">สรุปภาพรวม ({printDateDisplay})</h3>
                            <div className="flex justify-between text-sm">
                                <div><span>จำนวนรายการทั้งหมด:</span> <span className="font-bold ml-2">{filteredData.length} รายการ</span></div>
                                <div><span>ยอดเงินรวมสุทธิ (อนุมัติแล้ว):</span> <span className="font-bold ml-2">{totalAmount.toLocaleString()} บาท</span></div>
                            </div>
                            {filteredData.some(d => d.status === 'pending') && (
                                <div className="text-sm mt-1"><span>* มีรายการรอตรวจสอบ:</span> <span className="font-bold ml-2 text-red-600">{filteredData.filter(d=>d.status==='pending').length} รายการ</span></div>
                            )}
                        </div>

                        {/* Table */}
                        <div className="bg-white rounded-xl shadow-sm border overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase w-16">ลำดับ</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-32">วัน-เวลา</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ผู้บริจาค</th>
                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">รายการ</th>
                                        <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase w-24">ยอดเงิน</th>
                                        <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase w-20">ช่องทาง</th>
                                        <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase w-20">สถานะ</th>
                                        {(userRole === 'admin' || userRole === 'staff') && (<th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase no-print w-16">แก้ไข</th>)}
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200 text-sm">
                                    {filteredData.length > 0 ? filteredData.map((d, index) => (
                                        <tr key={d.id} className="hover:bg-gray-50 break-inside-avoid">
                                            <td className="px-4 py-3 text-center text-gray-500">{index + 1}</td>
                                            <td className="px-4 py-3">
                                                <div className="text-gray-900">{d.dateTime ? new Date(d.dateTime).toLocaleDateString('th-TH') : '-'}</div>
                                                <div className="text-xs text-gray-500">{d.dateTime ? new Date(d.dateTime).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}) : '-'}</div>
                                            </td>
                                            <td className="px-4 py-3 font-medium text-gray-900">{d.name}</td>
                                            <td className="px-4 py-3">
                                                <div className="text-gray-900 line-clamp-2">{d.purpose}</div>
                                                {d.roongTaanDate && <div className="text-xs text-orange-600 print:text-black">โรงทาน: {d.roongTaanDate} ({d.roongTaanNote})</div>}
                                            </td>
                                            <td className="px-4 py-3 text-right font-bold text-gray-900">{(d.amount || 0).toLocaleString()}</td>
                                            <td className="px-4 py-3 text-center text-gray-600">{d.method}</td>
                                            <td className="px-4 py-3 text-center">
                                                <span className={`status-badge px-2 py-1 text-xs rounded-full ${d.status==='approved'?'bg-green-100 text-green-800':d.status==='pending'?'bg-yellow-100 text-yellow-800':'bg-red-100 text-red-800'}`}>
                                                    {d.status==='approved'?'อนุมัติ':d.status==='pending'?'รอตรวจ':'ปฏิเสธ'}
                                                </span>
                                            </td>
                                            {(userRole === 'admin' || userRole === 'staff') && (<td className="px-4 py-3 text-center no-print"><button onClick={() => setEditingDonation(d)} className="text-gray-400 hover:text-orange-600 p-1 hover:bg-orange-50 rounded transition" title="แก้ไขข้อมูล"><Pencil className="w-4 h-4" /></button></td>)}
                                        </tr>
                                    )) : (
                                        <tr><td colSpan="8" className="text-center py-8 text-gray-500">ไม่พบข้อมูลตามเงื่อนไขที่เลือก</td></tr>
                                    )}
                                    {/* Total Row for Print */}
                                    {filteredData.length > 0 && (
                                        <tr className="bg-gray-100 font-bold print:bg-transparent border-t-2 border-black">
                                            <td colSpan="4" className="px-4 py-3 text-right pr-4">รวมยอดเงินทั้งสิ้น</td>
                                            <td className="px-4 py-3 text-right border-double border-b-4 border-black">{totalAmount.toLocaleString()}</td>
                                            <td colSpan="3"></td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>

                        {/* Signature Section (Print Only) */}
                        <div className="signature-section">
                            <div className="signature-box">
                                <p>จึงเรียนมาเพื่อโปรดทราบ</p>
                                <div className="signature-line"></div>
                                <p>(.......................................................)</p>
                                <p className="font-bold mt-1">เจ้าหน้าที่การเงิน / ผู้จัดทำ</p>
                                <p className="text-sm mt-1">วันที่ ......../......../............</p>
                            </div>
                            <div className="signature-box">
                                <p>ทราบ / ดำเนินการ</p>
                                <div className="signature-line"></div>
                                <p>(.......................................................)</p>
                                <p className="font-bold mt-1">เจ้าอาวาส / ประธานกรรมการ</p>
                                <p className="text-sm mt-1">วันที่ ......../......../............</p>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        function ApprovalPanel({ donations, onApprove, onReject }) {
            const pending = donations.filter(d => d.status === 'pending');
            const [viewSlip, setViewSlip] = useState(null);
            
            return (
                <div className="space-y-4 no-print">
                    {viewSlip && (<div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={() => setViewSlip(null)}><div className="relative max-w-3xl max-h-full"><img src={viewSlip} alt="Full Slip" className="max-w-full max-h-[90vh] rounded shadow-lg" /><button className="absolute -top-4 -right-4 bg-white rounded-full p-2 shadow" onClick={() => setViewSlip(null)}><X className="w-6 h-6" /></button></div></div>)}
                    <h2 className="text-xl font-bold flex items-center mb-4"><ShieldCheck className="w-6 h-6 mr-2 text-orange-600"/> รายการรออนุมัติ ({pending.length})</h2>
                    {pending.length === 0 ? (<div className="bg-white p-8 text-center rounded-xl shadow-sm border"><CheckCircle className="w-12 h-12 text-green-400 mx-auto mb-2" /><h3 className="font-medium text-gray-600">ไม่มีรายการค้างตรวจสอบ</h3></div>) : (
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            {pending.map(d => (
                                <div key={d.id} className="bg-white rounded-xl shadow border border-yellow-200 flex flex-col">
                                    <div className="p-4 flex-grow">
                                        <div className="text-xs text-gray-500 mb-1">{d.dateTime ? new Date(d.dateTime).toLocaleString('th-TH') : '-'}</div>
                                        <div className="font-bold text-lg mb-2">{d.name}</div>
                                        <div className="text-sm space-y-1 text-gray-600 mb-3"><div className="line-clamp-2"><span className="font-medium">รายการ:</span> {d.purpose}</div><div><span className="font-medium">ช่องทาง:</span> {d.method}</div>{d.slipImage && (<div className="mt-2"><button onClick={() => setViewSlip(d.slipImage)} className="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded flex items-center w-fit hover:bg-blue-100"><ImageIcon className="w-3 h-3 mr-1" /> ดูสลิปโอนเงิน</button></div>)}</div>
                                        <div className="text-xl font-bold text-orange-600 mb-2">{(d.amount || 0).toLocaleString()} ฿</div>
                                        {d.generalNote && <div className="text-xs text-gray-500 italic bg-gray-50 p-2 rounded">"{d.generalNote}"</div>}
                                    </div>
                                    <div className="flex border-t bg-gray-50"><button onClick={() => onApprove(d.id)} className="flex-1 py-3 text-green-700 font-bold hover:bg-green-100 flex justify-center border-r transition-colors"><Check className="w-5 h-5 mr-1"/> อนุมัติ</button><button onClick={() => onReject(d.id)} className="flex-1 py-3 text-red-600 font-bold hover:bg-red-50 flex justify-center transition-colors"><X className="w-5 h-5 mr-1"/> ปฏิเสธ</button></div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function AnnouncerPanel({ donations, onUpdateStatus, settings }) {
            const approvedDonations = useMemo(() => donations.filter(d => d.status === 'approved'), [donations]);
            const waitingQueue = useMemo(() => approvedDonations.filter(d => !d.announced).sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime)), [approvedDonations]);
            const announcedHistory = useMemo(() => approvedDonations.filter(d => d.announced).sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime)), [approvedDonations]);
            const currentDonor = waitingQueue.length > 0 ? waitingQueue[0] : null;
            const theme = settings?.themeColor || 'orange';

            return (
                <div className="space-y-6">
                    <div className="flex items-center justify-between mb-2"><h2 className="text-2xl font-bold text-gray-800 flex items-center"><Megaphone className={`w-7 h-7 mr-2 text-${theme}-600`} /> สำหรับโฆษก / ประกาศรายชื่อ</h2><div className={`text-sm bg-${theme}-100 text-${theme}-800 px-3 py-1 rounded-full border border-${theme}-200`}>รอประกาศ: <strong>{waitingQueue.length}</strong> | ประกาศแล้ว: <strong>{announcedHistory.length}</strong></div></div>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 space-y-4">
                            <div className={`bg-white rounded-2xl shadow-lg border-2 border-${theme}-200 overflow-hidden relative min-h-[400px] flex flex-col justify-center items-center p-8 text-center`}>
                                {currentDonor ? (
                                    <div className="w-full animate-fade-in">
                                        <div className="absolute top-4 left-4 bg-yellow-100 text-yellow-800 px-4 py-1 rounded-full text-sm font-bold flex items-center"><Mic className="w-4 h-4 mr-2" /> กำลังรอประกาศ</div>
                                        <div className="mb-2 text-gray-500 text-xl">ลำดับต่อไป... (เวลา: {currentDonor.dateTime ? new Date(currentDonor.dateTime).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}) : '-'})</div>
                                        <h1 className="text-5xl md:text-6xl font-bold text-gray-900 mb-6 leading-tight break-words">{currentDonor.name}</h1>
                                        <div className={`bg-${theme}-50 rounded-xl p-6 mb-8 w-full border border-${theme}-100 text-left`}>
                                            <div className={`mb-4 border-b border-${theme}-200 pb-4`}>
                                                <span className="block text-gray-500 text-lg mb-2">รายการที่บริจาค:</span>
                                                <ul className="text-2xl font-semibold text-gray-800 space-y-2">
                                                    {(currentDonor.purpose || "").split(', ').map((item, i) => (<li key={i} className="flex items-start"><span className="mr-2">•</span> {item}</li>))}
                                                    {currentDonor.roongTaanDate && (<li className={`flex items-start text-${theme}-700`}><span className="mr-2">•</span> โรงทานวันที่ {new Date(currentDonor.roongTaanDate).toLocaleDateString('th-TH')} ({currentDonor.roongTaanNote})</li>)}
                                                </ul>
                                            </div>
                                            <div className="flex justify-between items-end mb-4">
                                                <div><span className="block text-gray-500 text-lg">ช่องทาง:</span><span className="text-xl font-medium">{currentDonor.method}</span></div>
                                                <div className="text-right"><span className="block text-gray-500 text-lg">ยอดเงินรวม:</span><span className={`text-4xl font-bold text-${theme}-600`}>{(currentDonor.amount || 0).toLocaleString()} บาท</span></div>
                                            </div>
                                            {currentDonor.generalNote && (<div className={`mt-4 pt-4 border-t border-${theme}-200 bg-white p-4 rounded-lg border`}><span className="block text-gray-500 text-lg mb-1">หมายเหตุ / คำอวยพร:</span><span className="text-2xl italic text-gray-800">"{currentDonor.generalNote}"</span></div>)}
                                        </div>
                                        <button onClick={() => onUpdateStatus(currentDonor.id, true)} className={`w-full max-w-md bg-${theme}-600 hover:bg-${theme}-700 text-white text-2xl font-bold py-5 px-8 rounded-full shadow-lg transform transition hover:scale-105 flex items-center justify-center mx-auto`}><Megaphone className="w-8 h-8 mr-3" /> ประกาศแล้ว (ถัดไป)</button>
                                    </div>
                                ) : (<div className="text-gray-400 flex flex-col items-center"><CheckCircle className="w-20 h-20 mb-4 opacity-50" /><h3 className="text-3xl font-bold">ประกาศครบทุกรายการแล้ว</h3><p className="mt-2 text-lg">ไม่มีรายการรอประกาศในขณะนี้</p></div>)}
                            </div>
                        </div>
                        <div className="space-y-6">
                            <div className="bg-white rounded-xl shadow border p-4 max-h-[300px] overflow-y-auto">
                                <h3 className="text-lg font-bold text-gray-700 mb-3 border-b pb-2 flex items-center sticky top-0 bg-white"><div className="w-2 h-2 rounded-full bg-yellow-400 mr-2"></div> คิวรอถัดไป ({Math.max(0, waitingQueue.length - 1)})</h3>
                                {waitingQueue.slice(1).length > 0 ? (<ul className="space-y-2">{waitingQueue.slice(1).map(d => (<li key={d.id} className="p-3 bg-gray-50 rounded border flex justify-between items-center"><div className="overflow-hidden mr-2"><div className="font-medium truncate">{d.name}</div><div className="text-xs text-gray-400">{d.dateTime ? new Date(d.dateTime).toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}) : '-'}</div></div><span className={`text-${theme}-600 font-bold text-sm whitespace-nowrap`}>{(d.amount || 0).toLocaleString()}</span></li>))}</ul>) : (<p className="text-gray-400 text-sm text-center py-4">ไม่มีคิวรอ</p>)}
                            </div>
                            <div className="bg-white rounded-xl shadow border p-4 max-h-[300px] overflow-y-auto">
                                <h3 className="text-lg font-bold text-gray-700 mb-3 border-b pb-2 flex items-center sticky top-0 bg-white"><div className="w-2 h-2 rounded-full bg-green-500 mr-2"></div> ประกาศแล้ว ({announcedHistory.length})</h3>
                                {announcedHistory.length > 0 ? (<ul className="space-y-2">{announcedHistory.map(d => (<li key={d.id} className="p-3 bg-green-50 border border-green-100 rounded flex justify-between items-center group"><div className="flex flex-col truncate mr-2"><span className="font-medium text-gray-700 truncate">{d.name}</span><span className="text-xs text-green-600">ประกาศแล้ว</span></div><button onClick={() => onUpdateStatus(d.id, false)} className="text-gray-400 hover:text-red-500 p-1 rounded hover:bg-red-50 transition opacity-0 group-hover:opacity-100" title="ย้อนกลับ (Undo)"><RotateCcw className="w-4 h-4" /></button></li>))}</ul>) : (<p className="text-gray-400 text-sm text-center py-4">ยังไม่มีประวัติ</p>)}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function AdminSettingsPanel({ settings, onSave, onClearData }) {
            const [config, setConfig] = useState(settings);
            const [confirmClear, setConfirmClear] = useState('');
            const [showClearModal, setShowClearModal] = useState(false);
            const [activeSection, setActiveSection] = useState('general');
            const [isUploading, setIsUploading] = useState(false); 

            useEffect(() => { setConfig(settings); }, [settings]);
            const handleSave = () => { onSave(config); };
            const handleAddDonationType = () => { const newType = { id: `type_${Date.now()}`, name: 'รายการใหม่', hasQuantity: false, price: 0, active: true }; setConfig({ ...config, donationTypes: [...(config.donationTypes || []), newType] }); };
            const handleRemoveDonationType = (index) => { const newTypes = [...(config.donationTypes || [])]; newTypes.splice(index, 1); setConfig({...config, donationTypes: newTypes}); };
            const handleUpdateDonationType = (index, field, value) => { const newTypes = [...(config.donationTypes || [])]; newTypes[index] = { ...newTypes[index], [field]: value }; setConfig({...config, donationTypes: newTypes}); };
            const handleClearDataSubmit = () => { if (confirmClear === (config.passwords?.admin || 'admin104')) { onClearData(); setShowClearModal(false); setConfirmClear(''); } else { alert('รหัสผ่าน Admin ไม่ถูกต้อง'); } };
            const themeColors = [ { id: 'orange', name: 'ส้ม', class: 'bg-orange-500' }, { id: 'yellow', name: 'เหลือง', class: 'bg-yellow-500' }, { id: 'red', name: 'แดง', class: 'bg-red-600' }, { id: 'emerald', name: 'เขียว', class: 'bg-emerald-600' }, { id: 'blue', name: 'น้ำเงิน', class: 'bg-blue-600' }, { id: 'stone', name: 'ขาว/เทา', class: 'bg-stone-500' }, ];

            // Function for About Image Upload
            const handleAboutImageUpload = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    setIsUploading(true);
                    try {
                        const resized = await resizeImage(file);
                        setConfig(prev => ({
                            ...prev,
                            about: { ...prev.about, imageUrl: resized }
                        }));
                    } catch (err) {
                        alert("อัปโหลดรูปไม่สำเร็จ");
                    }
                    setIsUploading(false);
                }
            };

            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold flex items-center text-gray-800"><Settings className="w-8 h-8 mr-2 text-orange-600" /> ตั้งค่าระบบ (Super Admin)</h2>
                    <div className="flex space-x-2 border-b overflow-x-auto">
                        <button onClick={() => setActiveSection('general')} className={`px-4 py-2 font-medium ${activeSection === 'general' ? 'text-orange-600 border-b-2 border-orange-600' : 'text-gray-500 hover:text-gray-700'}`}>ทั่วไป/ธีม</button>
                        <button onClick={() => setActiveSection('about')} className={`px-4 py-2 font-medium ${activeSection === 'about' ? 'text-orange-600 border-b-2 border-orange-600' : 'text-gray-500 hover:text-gray-700'}`}>หน้าหลัก (About)</button>
                        <button onClick={() => setActiveSection('donation')} className={`px-4 py-2 font-medium ${activeSection === 'donation' ? 'text-orange-600 border-b-2 border-orange-600' : 'text-gray-500 hover:text-gray-700'}`}>การรับบริจาค</button>
                        <button onClick={() => setActiveSection('contact')} className={`px-4 py-2 font-medium ${activeSection === 'contact' ? 'text-orange-600 border-b-2 border-orange-600' : 'text-gray-500 hover:text-gray-700'}`}>ติดต่อ/โซเชียล</button>
                        <button onClick={() => setActiveSection('security')} className={`px-4 py-2 font-medium ${activeSection === 'security' ? 'text-orange-600 border-b-2 border-orange-600' : 'text-gray-500 hover:text-gray-700'}`}>ความปลอดภัย</button>
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        {activeSection === 'general' && (<div className="space-y-6 animate-fade-in"><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 className="text-lg font-bold mb-4 flex items-center"><PowerIcon className="w-5 h-5 mr-2" /> สถานะระบบ</h3><div className="space-y-2"><label className={`block p-3 rounded-lg border cursor-pointer ${config.systemStatus === 'open' ? 'bg-green-50 border-green-500 ring-1 ring-green-500' : 'bg-gray-50'}`}><div className="flex items-center"><input type="radio" name="status" className="mr-3" checked={config.systemStatus === 'open'} onChange={() => setConfig({...config, systemStatus: 'open'})} /><div><div className="font-bold text-green-700">เปิดรับบริจาค</div><div className="text-xs text-gray-500">ใช้งานปกติ</div></div></div></label><label className={`block p-3 rounded-lg border cursor-pointer ${config.systemStatus === 'closed' ? 'bg-red-50 border-red-500 ring-1 ring-red-500' : 'bg-gray-50'}`}><div className="flex items-center"><input type="radio" name="status" className="mr-3" checked={config.systemStatus === 'closed'} onChange={() => setConfig({...config, systemStatus: 'closed'})} /><div><div className="font-bold text-red-700">ปิดรับบริจาคชั่วคราว</div><div className="text-xs text-gray-500">แสดงหน้าเว็บ แต่ซ่อนฟอร์ม</div></div></div></label><label className={`block p-3 rounded-lg border cursor-pointer ${config.systemStatus === 'maintenance' ? 'bg-yellow-50 border-yellow-500 ring-1 ring-yellow-500' : 'bg-gray-50'}`}><div className="flex items-center"><input type="radio" name="status" className="mr-3" checked={config.systemStatus === 'maintenance'} onChange={() => setConfig({...config, systemStatus: 'maintenance'})} /><div><div className="font-bold text-yellow-700">ปิดปรับปรุงระบบ</div><div className="text-xs text-gray-500">แสดงหน้าแจ้งปิดปรับปรุง</div></div></div></label></div></div><div><h3 className="text-lg font-bold mb-4 flex items-center"><Palette className="w-5 h-5 mr-2" /> ธีมสีเว็บไซต์</h3><div className="grid grid-cols-3 gap-2 mb-4">{themeColors.map(color => (<button key={color.id} onClick={() => setConfig({...config, themeColor: color.id})} className={`p-2 rounded border flex flex-col items-center gap-1 transition-all ${config.themeColor === color.id ? 'ring-2 ring-offset-2 ring-gray-400 border-gray-400 bg-gray-50' : 'hover:bg-gray-50'}`}><div className={`w-8 h-8 rounded-full ${color.class}`}></div><span className="text-xs">{color.name}</span></button>))}</div><h3 className="text-lg font-bold mb-4 flex items-center"><Type className="w-5 h-5 mr-2" /> ฟอนต์ (แบบตัวอักษร)</h3><select className="w-full p-2 border rounded mb-4" value={config.fontFamily || 'Sarabun'} onChange={e => setConfig({...config, fontFamily: e.target.value})}>{FONT_OPTIONS.map(font => (<option key={font.id} value={font.id}>{font.name}</option>))}</select><div><label className="block text-sm font-medium mb-1">ข้อความวิ่ง (Marquee Text)</label><input type="text" className="w-full p-2 border rounded" value={config.marqueeText || ''} onChange={e => setConfig({...config, marqueeText: e.target.value})} placeholder="เว้นว่างหากไม่ต้องการแสดง" /></div></div></div><div className="pt-4 border-t"><h3 className="text-lg font-bold mb-4 flex items-center"><ImageIcon className="w-5 h-5 mr-2" /> ข้อมูลพื้นฐาน</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label className="text-sm font-medium">ชื่อวัด / องค์กร</label><input type="text" className="w-full p-2 border rounded" value={config.templeName} onChange={e => setConfig({...config, templeName: e.target.value})} /></div><div><label className="text-sm font-medium">ลิงค์รูปหน้าปก (Banner URL)</label><input type="text" className="w-full p-2 border rounded" value={config.bannerUrl} onChange={e => setConfig({...config, bannerUrl: e.target.value})} /></div></div></div></div>)}
                        
                        {/* New ABOUT Section */}
                        {activeSection === 'about' && (
                            <div className="space-y-6 animate-fade-in">
                                <h3 className="text-lg font-bold mb-4 flex items-center"><Layout className="w-5 h-5 mr-2" /> แก้ไขหน้าประวัติและข้อมูล</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">หัวข้อเล็ก (เช่น ประวัติและข้อมูล)</label>
                                            <input type="text" className="w-full p-2 border rounded" value={config.about?.title || ''} onChange={e => setConfig({...config, about: { ...config.about, title: e.target.value }})} />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">หัวข้อใหญ่ (เช่น ความร่มเย็นแห่งล้านนา)</label>
                                            <input type="text" className="w-full p-2 border rounded" value={config.about?.heading || ''} onChange={e => setConfig({...config, about: { ...config.about, heading: e.target.value }})} />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">คำที่ต้องการเน้นสีส้ม (ต้องตรงกับในหัวข้อใหญ่)</label>
                                            <input type="text" className="w-full p-2 border rounded text-orange-600 font-bold" value={config.about?.highlightWord || ''} onChange={e => setConfig({...config, about: { ...config.about, highlightWord: e.target.value }})} />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">เนื้อหา / รายละเอียด</label>
                                            <textarea rows="6" className="w-full p-2 border rounded" value={config.about?.content || ''} onChange={e => setConfig({...config, about: { ...config.about, content: e.target.value }})}></textarea>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">รูปภาพประกอบ</label>
                                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 cursor-pointer relative">
                                                <input type="file" className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*" onChange={handleAboutImageUpload} disabled={isUploading} />
                                                {isUploading ? (
                                                    <div className="flex flex-col items-center text-gray-500">
                                                        <Loader className="w-8 h-8 animate-spin mb-2" />
                                                        <span>กำลังอัปโหลด...</span>
                                                    </div>
                                                ) : config.about?.imageUrl ? (
                                                    <div className="relative">
                                                        <img src={config.about.imageUrl} alt="Preview" className="max-h-48 mx-auto rounded shadow" />
                                                        <div className="mt-2 text-xs text-gray-500">คลิกเพื่อเปลี่ยนรูป</div>
                                                    </div>
                                                ) : (
                                                    <div className="flex flex-col items-center text-gray-500">
                                                        <UploadCloud className="w-8 h-8 mb-2" />
                                                        <span>คลิกเพื่ออัปโหลดรูปภาพ</span>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        <div className="bg-gray-50 p-4 rounded text-sm text-gray-600">
                                            <strong>ตัวอย่างการแสดงผล:</strong>
                                            <div className="mt-2 p-3 bg-white border rounded">
                                                <div className="text-xs text-orange-600 mb-1">{config.about?.title}</div>
                                                <div className="font-bold text-lg">
                                                    {config.about?.heading?.replace(config.about?.highlightWord, '')}
                                                    <span className="text-orange-600">{config.about?.highlightWord}</span>
                                                </div>
                                                <div className="text-xs text-gray-500 mt-1 line-clamp-3">{config.about?.content}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeSection === 'donation' && (<div className="space-y-6 animate-fade-in"><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 className="text-lg font-bold mb-4 flex items-center"><User className="w-5 h-5 mr-2" /> บัญชีรับเงิน</h3><div className="space-y-3 p-4 bg-gray-50 rounded-lg border"><div><label className="text-xs text-gray-500">ธนาคาร</label><input type="text" className="w-full p-2 border rounded" value={config.bankInfo?.bankName} onChange={e => setConfig({...config, bankInfo: {...config.bankInfo, bankName: e.target.value}})} /></div><div><label className="text-xs text-gray-500">ชื่อบัญชี</label><input type="text" className="w-full p-2 border rounded" value={config.bankInfo?.accountName} onChange={e => setConfig({...config, bankInfo: {...config.bankInfo, accountName: e.target.value}})} /></div><div><label className="text-xs text-gray-500">เลขบัญชี</label><input type="text" className="w-full p-2 border rounded font-mono text-lg" value={config.bankInfo?.accountNumber} onChange={e => setConfig({...config, bankInfo: {...config.bankInfo, accountNumber: e.target.value}})} /></div><div><label className="text-xs text-gray-500">ลิงค์รูป QR Code</label><input type="text" className="w-full p-2 border rounded" value={config.qrCodeUrl} onChange={e => setConfig({...config, qrCodeUrl: e.target.value})} /></div></div></div><div><h3 className="text-lg font-bold mb-4 flex items-center"><Settings className="w-5 h-5 mr-2" /> ตั้งค่าเงื่อนไข</h3><div className="space-y-4"><div className="flex items-center justify-between p-3 border rounded-lg"><span>จำเป็นต้องแนบสลิปโอนเงิน</span><label className="relative inline-flex items-center cursor-pointer"><input type="checkbox" className="sr-only peer" checked={config.requireSlip !== false} onChange={e => setConfig({...config, requireSlip: e.target.checked})} /><div className="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div></label></div><div><label className="block text-sm font-medium mb-1">ข้อความขอบคุณ (อนุโมทนา)</label><textarea rows="3" className="w-full p-2 border rounded" value={config.messages?.thankYou || ''} onChange={e => setConfig({...config, messages: {...config.messages, thankYou: e.target.value}})}></textarea></div></div></div></div><div className="pt-4 border-t"><div className="flex justify-between items-center mb-4"><h3 className="text-lg font-bold flex items-center"><ClipboardList className="w-5 h-5 mr-2" /> รายการรับบริจาค</h3><button onClick={handleAddDonationType} className="text-sm bg-blue-50 text-blue-600 px-3 py-1 rounded hover:bg-blue-100 flex items-center"><Plus className="w-4 h-4 mr-1"/> เพิ่มรายการ</button></div><div className="overflow-x-auto"><table className="w-full text-sm text-left"><thead className="bg-gray-50 text-gray-500"><tr><th className="p-2">ชื่อรายการ</th><th className="p-2 text-center">มีจำนวน?</th><th className="p-2 text-right">ราคา/หน่วย</th><th className="p-2 text-center">หน่วยนับ</th><th className="p-2 text-center">ลบ</th></tr></thead><tbody className="divide-y">{(config.donationTypes || []).map((type, idx) => (<tr key={idx}><td className="p-2"><input type="text" className="w-full p-1 border rounded" value={type.name} onChange={e => handleUpdateDonationType(idx, 'name', e.target.value)} disabled={type.isSpecial} /></td><td className="p-2 text-center"><input type="checkbox" checked={type.hasQuantity} onChange={e => handleUpdateDonationType(idx, 'hasQuantity', e.target.checked)} disabled={type.isSpecial} /></td><td className="p-2"><input type="number" className="w-full p-1 border rounded text-right" value={type.price || 0} onChange={e => handleUpdateDonationType(idx, 'price', parseInt(e.target.value))} disabled={!type.hasQuantity && !type.isSpecial} /></td><td className="p-2"><input type="text" className="w-full p-1 border rounded text-center" value={type.unit || ''} onChange={e => handleUpdateDonationType(idx, 'unit', e.target.value)} disabled={!type.hasQuantity} placeholder="-" /></td><td className="p-2 text-center">{!type.isSpecial && (<button onClick={() => handleRemoveDonationType(idx)} className="text-red-500 hover:text-red-700"><Trash2 className="w-4 h-4" /></button>)}</td></tr>))}</tbody></table></div></div></div>)}
                        {activeSection === 'contact' && (<div className="space-y-6 animate-fade-in"><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 className="text-lg font-bold mb-4 flex items-center"><MapPin className="w-5 h-5 mr-2" /> ข้อมูลติดต่อ</h3><div className="space-y-3"><div><label className="text-sm font-medium">เบอร์โทรศัพท์</label><input type="text" className="w-full p-2 border rounded" value={config.contact?.phone} onChange={e => setConfig({...config, contact: {...config.contact, phone: e.target.value}})} /></div><div><label className="text-sm font-medium">ที่อยู่</label><textarea rows="3" className="w-full p-2 border rounded" value={config.contact?.address} onChange={e => setConfig({...config, contact: {...config.contact, address: e.target.value}})}></textarea></div></div></div><div><h3 className="text-lg font-bold mb-4 flex items-center"><MessageCircle className="w-5 h-5 mr-2" /> โซเชียลมีเดีย</h3><div className="space-y-3"><div><label className="text-sm font-medium">Facebook Link</label><input type="text" className="w-full p-2 border rounded" value={config.contact?.facebook || ''} onChange={e => setConfig({...config, contact: {...config.contact, facebook: e.target.value}})} placeholder="https://facebook.com/..." /></div><div><label className="text-sm font-medium">Line Link / ID</label><input type="text" className="w-full p-2 border rounded" value={config.contact?.line || ''} onChange={e => setConfig({...config, contact: {...config.contact, line: e.target.value}})} placeholder="https://line.me/..." /></div></div></div></div></div>)}
                        {activeSection === 'security' && (<div className="space-y-6 animate-fade-in"><div className="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-4 text-sm text-yellow-800"><AlertTriangle className="w-4 h-4 inline mr-1" /> คำเตือน: กรุณาจดจำรหัสผ่านใหม่ให้แม่นยำ หากลืมจะไม่สามารถกู้คืนได้ง่าย</div><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 className="text-lg font-bold mb-4 text-blue-700 flex items-center"><User className="w-5 h-5 mr-2" /> รหัสเจ้าหน้าที่ (Staff)</h3><p className="text-sm text-gray-500 mb-2">สำหรับเจ้าหน้าที่จุดรับบริจาค (บันทึกข้อมูลได้ แต่ลบไม่ได้)</p><input type="text" className="w-full p-2 border rounded bg-gray-50" value={config.passwords?.staff || '104'} onChange={e => setConfig({...config, passwords: {...config.passwords, staff: e.target.value}})} /></div><div><h3 className="text-lg font-bold mb-4 text-red-700 flex items-center"><ShieldCheck className="w-5 h-5 mr-2" /> รหัสผู้ดูแลระบบ (Admin)</h3><p className="text-sm text-gray-500 mb-2">สิทธิ์สูงสุด (ตั้งค่าระบบ, ลบข้อมูล, อนุมัติรายการ)</p><input type="text" className="w-full p-2 border rounded bg-gray-50" value={config.passwords?.admin || 'admin104'} onChange={e => setConfig({...config, passwords: {...config.passwords, admin: e.target.value}})} /></div></div></div>)}
                    </div>
                    <div className="flex flex-col sm:flex-row gap-4 pt-4 border-t mt-6"><button onClick={handleSave} className="flex-1 bg-orange-600 hover:bg-orange-700 text-white py-3 rounded-lg font-bold shadow-lg flex justify-center items-center transition-transform hover:scale-105"><Save className="w-5 h-5 mr-2" /> บันทึกการตั้งค่าทั้งหมด</button><button onClick={() => setShowClearModal(true)} className="flex-none bg-red-100 hover:bg-red-200 text-red-700 py-3 px-6 rounded-lg font-bold flex justify-center items-center transition-colors"><Trash2 className="w-5 h-5 mr-2" /> ล้างข้อมูลบริจาค</button></div>
                    {showClearModal && (<div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white rounded-xl shadow-xl max-w-sm w-full p-6 text-center animate-scale-up"><AlertTriangle className="w-12 h-12 text-red-500 mx-auto mb-4" /><h3 className="text-xl font-bold text-red-600 mb-2">ยืนยันล้างข้อมูลทั้งหมด?</h3><p className="text-gray-600 mb-4 text-sm">การกระทำนี้จะลบรายการบริจาคทั้งหมดอย่างถาวร ไม่สามารถกู้คืนได้</p><input type="password" placeholder="ใส่รหัส Admin เพื่อยืนยัน" className="w-full p-2 border border-red-300 rounded mb-4" value={confirmClear} onChange={e => setConfirmClear(e.target.value)} /><div className="flex gap-2"><button onClick={() => setShowClearModal(false)} className="flex-1 bg-gray-200 py-2 rounded hover:bg-gray-300">ยกเลิก</button><button onClick={handleClearDataSubmit} className="flex-1 bg-red-600 text-white py-2 rounded font-bold hover:bg-red-700">ยืนยันลบ</button></div></div></div>)}
                </div>
            );
        }

        // ==========================================
        // 6. MAIN CONTAINERS
        // ==========================================
        function DonationSystem({ onBack, donations, settings, onAdd, onUpdate, onUpdateSettings, onClearData, showNotification, user }) {
            const [activeTab, setActiveTab] = useState('donate');
            const [userRole, setUserRole] = useState('donor'); 
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [pendingRole, setPendingRole] = useState(null); 
            const theme = settings.themeColor || 'orange';

            const handleRoleSwitch = (newRole) => {
                if (newRole === 'donor') { 
                    setUserRole('donor'); 
                    setIsAuthenticated(false); 
                    setActiveTab('donate'); 
                } else { 
                    setPendingRole(newRole); 
                    setShowLoginModal(true); 
                }
            };

            const handleLogout = () => { 
                setUserRole('donor'); 
                setIsAuthenticated(false); 
                setActiveTab('donate'); 
                showNotification('ออกจากระบบเรียบร้อยแล้ว'); 
            };
            
            const toggleAnnounced = (id, status) => { 
                const item = donations.find(d => d.id === id); 
                if (item) onUpdate({ ...item, announced: status }); 
            };

            return (
                <div className={`min-h-screen bg-${theme}-50 text-gray-800`}> {/* ลบ no-print ออกแล้ว */}
                    {showLoginModal && (
                        <LoginModal 
                            role={pendingRole}
                            settings={settings}
                            onClose={() => setShowLoginModal(false)}
                            onLoginSuccess={() => { 
                                setUserRole(pendingRole); 
                                setIsAuthenticated(true); 
                                setShowLoginModal(false); 
                                showNotification(`เข้าสู่ระบบในฐานะ ${pendingRole === 'staff' ? 'เจ้าหน้าที่' : 'ผู้ดูแลระบบ'} สำเร็จ`); 
                            }}
                        />
                    )}

                    <header className={`bg-${theme}-600 text-white shadow-md no-print`}>
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-4 w-full sm:w-auto">
                                <button onClick={onBack} className={`p-2 bg-${theme}-700 hover:bg-${theme}-800 rounded-full transition-colors shrink-0`} title="กลับหน้าเว็บไซต์หลัก">
                                    <ArrowLeft className="w-6 h-6" />
                                </button>
                                <div>
                                    <h1 className="text-xl sm:text-2xl font-bold">ระบบรับบริจาค{settings.templeName}</h1>
                                    <p className={`text-xs sm:text-sm text-${theme}-200`}>ระบบจัดการออนไลน์</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 w-full sm:w-auto justify-between sm:justify-end">
                                {isAuthenticated ? (
                                    <div className={`flex items-center gap-3 bg-${theme}-700 px-4 py-2 rounded-lg`}>
                                        <div className="flex items-center gap-2">
                                            <User className={`w-5 h-5 text-${theme}-200`} />
                                            <span className="font-medium text-sm">{userRole === 'staff' ? 'เจ้าหน้าที่ (Staff)' : 'ผู้ดูแลระบบ (Admin)'}</span>
                                        </div>
                                        <button onClick={handleLogout} className="bg-red-500 hover:bg-red-600 text-white p-1 rounded transition-colors" title="ออกจากระบบ">
                                            <LogOut className="w-4 h-4" />
                                        </button>
                                    </div>
                                ) : (
                                    <div className={`flex items-center gap-2 text-sm bg-${theme}-700 p-2 rounded-lg`}>
                                        <span className="font-medium whitespace-nowrap flex items-center gap-1"><Lock className="w-3 h-3"/> เข้าใช้งาน:</span>
                                        <select className="bg-white text-gray-800 rounded px-2 py-1 outline-none w-full sm:w-auto text-xs sm:text-sm cursor-pointer" value={userRole} onChange={(e) => handleRoleSwitch(e.target.value)}>
                                            <option value="donor">ผู้บริจาค (Guest)</option>
                                            <option value="staff">หน่วยรับบริจาค (Staff)</option>
                                            <option value="admin">ผู้ดูแลระบบ (Admin)</option>
                                        </select>
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    <nav className="bg-white shadow-sm sticky top-0 z-10 no-print">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex space-x-4 overflow-x-auto hide-scrollbar">
                                <button onClick={() => setActiveTab('donate')} className={`flex items-center px-4 py-3 border-b-2 font-medium whitespace-nowrap ${activeTab === 'donate' ? `border-${theme}-500 text-${theme}-600` : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <PlusCircle className="w-5 h-5 mr-2 shrink-0" /> {userRole === 'donor' ? 'บริจาคออนไลน์' : 'บันทึกรับบริจาค'}
                                </button>
                                {isAuthenticated && (
                                    <button onClick={() => setActiveTab('dashboard')} className={`flex items-center px-4 py-3 border-b-2 font-medium whitespace-nowrap ${activeTab === 'dashboard' ? `border-${theme}-500 text-${theme}-600` : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                        <ClipboardList className="w-5 h-5 mr-2 shrink-0" /> สรุป/รายงาน
                                    </button>
                                )}
                                {isAuthenticated && (
                                    <button onClick={() => setActiveTab('announcer')} className={`flex items-center px-4 py-3 border-b-2 font-medium whitespace-nowrap ${activeTab === 'announcer' ? `border-${theme}-500 text-${theme}-600` : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                        <Megaphone className="w-5 h-5 mr-2 shrink-0" /> โฆษก/ประกาศ
                                    </button>
                                )}
                                {isAuthenticated && (
                                    <button onClick={() => setActiveTab('news')} className={`flex items-center px-4 py-3 border-b-2 font-medium whitespace-nowrap ${activeTab === 'news' ? `border-${theme}-500 text-${theme}-600` : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                        <Newspaper className="w-5 h-5 mr-2 shrink-0" /> ข่าวประชาสัมพันธ์
                                    </button>
                                )}
                                {isAuthenticated && userRole === 'admin' && (
                                    <>
                                        <button onClick={() => setActiveTab('approval')} className={`flex items-center px-4 py-3 border-b-2 font-medium whitespace-nowrap ${activeTab === 'approval' ? `border-${theme}-500 text-${theme}-600` : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                            <CheckCircle className="w-5 h-5 mr-2 shrink-0" /> อนุมัติรายการ 
                                            {donations.filter(d => d.status === 'pending').length > 0 && <span className="ml-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full shrink-0">{donations.filter(d => d.status === 'pending').length}</span>}
                                        </button>
                                        <button onClick={() => setActiveTab('settings')} className={`flex items-center px-4 py-3 border-b-2 font-medium whitespace-nowrap ${activeTab === 'settings' ? `border-${theme}-500 text-${theme}-600` : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                            <Settings className="w-5 h-5 mr-2 shrink-0" /> ตั้งค่าระบบ
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-20"> {/* ลบ print-container ออกแล้ว */}
                        {activeTab === 'donate' && (
                            <DonationForm 
                                userRole={userRole} 
                                settings={settings}
                                onSave={(newDonation) => { 
                                    onAdd(newDonation); 
                                }} 
                                showNotification={showNotification}
                            />
                        )}
                        {activeTab === 'dashboard' && isAuthenticated && (
                            <Dashboard 
                                donations={donations} 
                                userRole={userRole} 
                                onUpdateDonation={(d) => { onUpdate(d); }} 
                                showNotification={showNotification}
                                settings={settings}
                            />
                        )}
                        {activeTab === 'announcer' && isAuthenticated && (
                            <AnnouncerPanel donations={donations} onUpdateStatus={toggleAnnounced} settings={settings} />
                        )}
                        {activeTab === 'news' && isAuthenticated && (
                            <NewsManager showNotification={showNotification} />
                        )}
                        {activeTab === 'approval' && userRole === 'admin' && isAuthenticated && (
                            <ApprovalPanel 
                                donations={donations} 
                                onApprove={(id) => { 
                                    const item = donations.find(d => d.id === id); 
                                    if (item) onUpdate({ ...item, status: 'approved' }); 
                                }} 
                                onReject={(id) => { 
                                    const item = donations.find(d => d.id === id); 
                                    if (item) onUpdate({ ...item, status: 'rejected' }); 
                                }} 
                            />
                        )}
                        {activeTab === 'settings' && userRole === 'admin' && isAuthenticated && (
                            <AdminSettingsPanel 
                                settings={settings}
                                onSave={onUpdateSettings}
                                onClearData={onClearData}
                            />
                        )}
                    </main>
                </div>
            );
        }

        function OfficialWebsite({ onNavigate, donations, settings }) {
            const [isScrolled, setIsScrolled] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [newsList, setNewsList] = useState([]);
            const [selectedNews, setSelectedNews] = useState(null); 
            const totalAmount = useMemo(() => donations.filter(d => d.status === 'approved').reduce((sum, d) => sum + (Number(d.amount) || 0), 0), [donations]);
            const theme = settings.themeColor || 'orange';

            const aboutTitle = settings.about?.title || "ประวัติและข้อมูล";
            const aboutHeading = settings.about?.heading || "ความร่มเย็นแห่งล้านนา";
            const aboutHighlight = settings.about?.highlightWord || "ล้านนา";
            const aboutContent = settings.about?.content || "วัดไชยามาตย์...";
            const aboutImage = settings.about?.imageUrl || "https://images.unsplash.com/photo-1579548231964-b0a701fccf23?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80";

            const renderHeading = () => {
                if (!aboutHighlight) return aboutHeading;
                const parts = aboutHeading.split(aboutHighlight);
                return (
                    <>
                        {parts.map((part, i) => (
                            <React.Fragment key={i}>
                                {part}
                                {i < parts.length - 1 && <span className={`text-${theme}-600`}>{aboutHighlight}</span>}
                            </React.Fragment>
                        ))}
                    </>
                );
            };

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => {
                const q = query(collection(db, 'news'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    docs.forEach(doc => {
                        if (doc.imageUrl && (!doc.images || doc.images.length === 0)) {
                            doc.images = [doc.imageUrl];
                        }
                    });
                    docs.sort((a, b) => new Date(b.date) - new Date(a.date));
                    setNewsList(docs);
                });
                return () => unsubscribe();
            }, []);

            const navLinks = [
                { name: 'หน้าหลัก', href: '#home' }, 
                { name: 'ประวัติวัด', href: '#about' }, 
                { name: 'ข่าวสาร/กิจกรรม', href: '#news' },
                { name: 'ติดต่อเรา', href: '#contact' }
            ];

            if (settings.systemStatus === 'maintenance') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-gray-100 text-gray-600 p-4 text-center relative">
                        <AlertTriangle className="w-16 h-16 text-yellow-500 mb-4" />
                        <h1 className="text-3xl font-bold mb-2">ปิดปรับปรุงชั่วคราว</h1>
                        <p>ระบบกำลังดำเนินการปรับปรุง ขออภัยในความไม่สะดวก</p>
                        <p className="mt-4 text-sm text-gray-500">{settings.templeName}</p>
                        <button onClick={() => onNavigate('donate-system')} className={`absolute top-4 right-4 p-2 text-gray-400 hover:text-${theme}-600 transition-colors flex items-center gap-1 group`} title="ผู้ดูแลระบบ">
                            <span className="text-xs opacity-0 group-hover:opacity-100 transition-opacity">Admin</span>
                            <Lock className="w-5 h-5" />
                        </button>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen bg-${theme}-50 text-gray-800 scroll-smooth`}>
                    <style>{`
                        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
                        .animate-marquee { animation: marquee 25s linear infinite; }
                    `}</style>

                    {settings.marqueeText && (
                        <div className={`bg-${theme}-800 text-white text-sm py-2 overflow-hidden relative z-[60]`}>
                            <div className="whitespace-nowrap animate-marquee px-4">{settings.marqueeText}</div>
                        </div>
                    )}

                    <nav className={`fixed w-full z-50 transition-all duration-300 ${isScrolled ? 'bg-white shadow-md py-2' : 'bg-transparent py-4'} ${settings.marqueeText ? 'top-8' : 'top-0'}`}>
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${isScrolled ? `bg-${theme}-600 text-white` : `bg-white text-${theme}-600`}`}>
                                        <BookOpen className="w-6 h-6" />
                                    </div>
                                    <span className={`text-xl font-bold ${isScrolled ? `text-${theme}-800` : 'text-white drop-shadow-md'}`}>{settings.templeName}</span>
                                </div>
                                <div className="hidden md:flex items-center space-x-8">
                                    {navLinks.map((link) => (
                                        <a key={link.name} href={link.href} className={`font-medium hover:text-${theme}-400 transition-colors ${isScrolled ? 'text-gray-600' : 'text-white drop-shadow-md'}`}>{link.name}</a>
                                    ))}
                                    <button onClick={() => onNavigate('donate-system')} className={`${settings.systemStatus === 'open' ? `bg-${theme}-600 hover:bg-${theme}-700` : 'bg-gray-600 hover:bg-gray-700'} text-white px-6 py-2 rounded-full font-bold flex items-center transition-transform hover:scale-105 shadow-lg`}>
                                        {settings.systemStatus === 'open' ? (<><HeartHandshake className="w-5 h-5 mr-2" /> ร่วมทำบุญ</>) : (<><Lock className="w-4 h-4 mr-2" /> เข้าสู่ระบบ (จนท.)</>)}
                                    </button>
                                </div>
                                <div className="md:hidden">
                                    <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className={isScrolled ? 'text-gray-800' : 'text-white'}>
                                        {mobileMenuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
                                    </button>
                                </div>
                            </div>
                        </div>
                        {mobileMenuOpen && (
                            <div className="md:hidden bg-white absolute top-full left-0 w-full shadow-lg border-t border-gray-100">
                                <div className="px-4 pt-2 pb-4 space-y-1 flex flex-col">
                                    {navLinks.map((link) => (
                                        <a key={link.name} href={link.href} onClick={() => setMobileMenuOpen(false)} className={`block px-3 py-3 text-base font-medium text-gray-700 hover:text-${theme}-600 hover:bg-${theme}-50 rounded-md`}>{link.name}</a>
                                    ))}
                                    <button onClick={() => onNavigate('donate-system')} className={`mt-4 w-full ${settings.systemStatus === 'open' ? `bg-${theme}-600` : 'bg-gray-600'} text-white px-4 py-3 rounded-md font-bold flex justify-center items-center`}>
                                        {settings.systemStatus === 'open' ? (<><HeartHandshake className="w-5 h-5 mr-2" /> ร่วมทำบุญออนไลน์</>) : (<><Lock className="w-4 h-4 mr-2" /> เข้าสู่ระบบ (จนท.)</>)}
                                    </button>
                                </div>
                            </div>
                        )}
                    </nav>

                    {/* 1. Header/Hero Section */}
                    <section id="home" className="relative h-[85vh] flex items-center justify-center bg-gray-900">
                        <div className="absolute inset-0 w-full h-full">
                            <img src={settings.bannerUrl} alt="ภาพวัด" className="w-full h-full object-cover opacity-60" />
                            <div className="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
                        </div>
                        <div className="relative z-20 text-center px-4 max-w-4xl mx-auto">
                            <span className={`block text-${theme}-400 font-semibold tracking-wider mb-2`}>ยินดีต้อนรับสู่</span>
                            <h1 className="text-5xl md:text-7xl font-bold text-white mb-6 leading-tight drop-shadow-lg">{settings.templeName}</h1>
                            <p className="text-xl md:text-2xl text-gray-200 mb-8 drop-shadow">ศูนย์รวมจิตใจชาวตำบลเวียงทอง สืบสานพระพุทธศาสนาและวัฒนธรรมล้านนา</p>
                            <div className="mb-10 inline-block">
                                <div className="backdrop-blur-md bg-white/10 border border-white/30 rounded-2xl p-6 shadow-2xl transform hover:scale-105 transition duration-300">
                                    <p className={`text-${theme}-200 text-sm md:text-base font-medium mb-1 uppercase tracking-widest`}>ยอดบริจาครวมทั้งหมด</p>
                                    <div className="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-200 drop-shadow-sm">฿ {(totalAmount || 0).toLocaleString()}</div>
                                </div>
                            </div>
                            {settings.systemStatus === 'open' ? (
                                <div className="flex flex-col sm:flex-row gap-4 justify-center">
                                    <button onClick={() => onNavigate('donate-system')} className={`bg-${theme}-600 hover:bg-${theme}-700 text-white px-8 py-4 rounded-full font-bold text-lg flex items-center justify-center transition-transform hover:scale-105 shadow-xl border-2 border-${theme}-500`}>
                                        <HeartHandshake className="w-6 h-6 mr-2" /> ร่วมบริจาค / จองโรงทาน
                                    </button>
                                    <a href="#about" className="bg-white/20 hover:bg-white/30 backdrop-blur-md text-white px-8 py-4 rounded-full font-bold text-lg flex items-center justify-center transition-colors border border-white/50">ประวัติความเป็นมา</a>
                                </div>
                            ) : (
                                <button onClick={() => onNavigate('donate-system')} className="bg-red-500/80 backdrop-blur text-white px-6 py-3 rounded-lg inline-flex items-center hover:bg-red-600/90 transition-colors cursor-pointer" title="คลิกเพื่อเข้าสู่ระบบเจ้าหน้าที่">
                                    <Lock className="w-4 h-4 mr-2" /> ขณะนี้ปิดรับบริจาคชั่วคราว (Admin Click)
                                </button>
                            )}
                        </div>
                    </section>

                    {/* 2. History/About Section (EDITABLE) */}
                    <section id="about" className="py-20 bg-white">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex flex-col md:flex-row items-center gap-12">
                                <div className="md:w-1/2 relative">
                                    <div className={`absolute -inset-4 bg-${theme}-100 rounded-3xl transform rotate-3 -z-10`}></div>
                                    <img src={aboutImage} alt="ประวัติวัด" className="w-full h-auto rounded-2xl shadow-lg object-cover aspect-[4/3]" />
                                </div>
                                <div className="md:w-1/2">
                                    <div className={`flex items-center gap-2 text-${theme}-600 font-semibold mb-2`}><BookOpen className="w-5 h-5" /> {aboutTitle}</div>
                                    <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-6">{renderHeading()}</h2>
                                    <p className="text-gray-600 text-lg leading-relaxed mb-6 whitespace-pre-line">{aboutContent}</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* 3. News Section (New Order) */}
                    {newsList.length > 0 && (
                        <section id="news" className="py-20 bg-gray-50">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="text-center mb-12">
                                    <h2 className={`text-3xl md:text-4xl font-bold text-gray-900`}>ข่าวประชาสัมพันธ์<span className={`text-${theme}-600`}>และกิจกรรม</span></h2>
                                    <div className={`h-1 w-20 bg-${theme}-500 mx-auto mt-4 rounded-full`}></div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                    {newsList.map(news => {
                                        const coverImage = (news.images && news.images.length > 0) ? news.images[0] : news.imageUrl;
                                        return (
                                            <div key={news.id} className="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 group cursor-pointer" onClick={() => setSelectedNews(news)}>
                                                <div className="h-56 bg-gray-200 overflow-hidden relative">
                                                    {coverImage ? (
                                                        <img src={coverImage} alt={news.title} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                                                    ) : (
                                                        <div className="w-full h-full flex items-center justify-center text-gray-400">
                                                            <ImageIcon className="w-12 h-12" />
                                                        </div>
                                                    )}
                                                    {news.images && news.images.length > 1 && (
                                                        <div className="absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-md">
                                                            +{news.images.length - 1} รูป
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="p-6">
                                                    <div className={`text-sm font-semibold text-${theme}-600 mb-2 flex items-center`}>
                                                        <Calendar className="w-4 h-4 mr-2" />
                                                        {new Date(news.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}
                                                    </div>
                                                    <h3 className="text-xl font-bold text-gray-900 mb-3 line-clamp-2 group-hover:text-orange-600 transition-colors">{news.title}</h3>
                                                    <p className="text-gray-600 text-sm line-clamp-3 mb-4">{news.content}</p>
                                                    <button onClick={(e) => { e.stopPropagation(); setSelectedNews(news); }} className={`text-${theme}-600 font-semibold hover:underline text-sm`}>อ่านเพิ่มเติม →</button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </section>
                    )}

                    {/* News Modal Overlay */}
                    {selectedNews && (
                        <div className="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => setSelectedNews(null)}>
                            <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-scale-up flex flex-col" onClick={e => e.stopPropagation()}>
                                <div className="relative">
                                    {/* Main Image */}
                                    {selectedNews.images && selectedNews.images.length > 0 ? (
                                        <img src={selectedNews.images[0]} alt={selectedNews.title} className="w-full h-64 md:h-96 object-cover" />
                                    ) : (
                                        <div className={`w-full h-32 bg-${theme}-100 flex items-center justify-center`}>
                                            <ImageIcon className={`w-12 h-12 text-${theme}-300`} />
                                        </div>
                                    )}
                                    <button 
                                        onClick={() => setSelectedNews(null)} 
                                        className="absolute top-4 right-4 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors shadow-lg backdrop-blur-md"
                                    >
                                        <X className="w-6 h-6" />
                                    </button>
                                </div>
                                <div className="p-6 md:p-8">
                                    <div className={`text-sm font-bold text-${theme}-600 mb-3 flex items-center bg-${theme}-50 w-fit px-3 py-1 rounded-full`}>
                                        <Calendar className="w-4 h-4 mr-2" />
                                        {new Date(selectedNews.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}
                                    </div>
                                    <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-6 leading-tight">{selectedNews.title}</h2>
                                    <div className="text-gray-700 leading-relaxed whitespace-pre-wrap text-lg mb-8">
                                        {selectedNews.content}
                                    </div>

                                    {/* Gallery Grid */}
                                    {selectedNews.images && selectedNews.images.length > 1 && (
                                        <div className="border-t pt-6">
                                            <h4 className="text-lg font-bold mb-4 flex items-center text-gray-700"><ImageIcon className="w-5 h-5 mr-2" /> รูปภาพเพิ่มเติม</h4>
                                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                                {selectedNews.images.slice(1).map((img, idx) => (
                                                    <a href={img} target="_blank" rel="noopener noreferrer" key={idx} className="block aspect-square rounded-lg overflow-hidden border hover:opacity-90 transition">
                                                        <img src={img} alt={`gallery-${idx}`} className="w-full h-full object-cover" />
                                                    </a>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <div className="mt-8 pt-6 border-t flex justify-end">
                                        <button 
                                            onClick={() => setSelectedNews(null)}
                                            className={`bg-${theme}-600 hover:bg-${theme}-700 text-white px-6 py-2 rounded-lg font-bold shadow-md transition-transform hover:scale-105`}
                                        >
                                            ปิดหน้าต่าง
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 4. Contact/Footer Section */}
                    <footer id="contact" className="bg-gray-900 text-white pt-16 pb-8">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-12 mb-12 border-b border-gray-800 pb-12">
                                <div>
                                    <div className="flex items-center gap-3 mb-6"><div className={`w-10 h-10 rounded-full bg-${theme}-600 flex items-center justify-center text-white`}><BookOpen className="w-6 h-6" /></div><span className="text-2xl font-bold text-white">{settings.templeName}</span></div>
                                    <div className="flex space-x-4 mt-4">
                                        {settings.contact.facebook && <a href={settings.contact.facebook} target="_blank" className="text-gray-400 hover:text-white"><Facebook className="w-6 h-6" /></a>}
                                        {settings.contact.line && <a href={settings.contact.line} target="_blank" className="text-gray-400 hover:text-white"><MessageCircle className="w-6 h-6" /></a>}
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-lg font-bold mb-6 text-white">ข้อมูลติดต่อ</h3>
                                    <ul className="space-y-4">
                                        <li className="flex items-start"><MapPin className={`w-5 h-5 text-${theme}-500 mr-3 mt-1 flex-shrink-0`} /><span className="text-gray-400">{settings.contact.address}</span></li>
                                        <li className="flex items-center"><Phone className={`w-5 h-5 text-${theme}-500 mr-3 flex-shrink-0`} /><span className="text-gray-400">{settings.contact.phone}</span></li>
                                    </ul>
                                </div>
                                <div><h3 className="text-lg font-bold mb-6 text-white">เวลาทำการ</h3><p className="text-gray-400">06:00 - 18:00 น. ทุกวัน</p></div>
                            </div>
                            <div className="text-center text-gray-500 text-sm"><p>&copy; {new Date().getFullYear()} {settings.templeName}. All rights reserved.</p></div>
                        </div>
                    </footer>
                </div>
            );
        }

        // ==========================================
        // 7. APP & ROOT
        // ==========================================
        function App() {
            const [currentRoute, setCurrentRoute] = useState('home');
            const [donations, setDonations] = useState([]);
            const [settings, setSettings] = useState(DEFAULT_SETTINGS);
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);
            const [notification, setNotification] = useState(null);

            const showNotification = (msg, type = 'success') => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 3000);
            };

            // Auth Initialization
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (error) {
                        console.error("Auth error:", error);
                        setLoading(false);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    if(!u) setLoading(false); 
                });
                return () => unsubscribe();
            }, []);

            // Fetch Settings with Error Handling
            useEffect(() => {
                if (!user) return;
                const settingsRef = doc(db, 'settings', 'config'); 
                const unsubscribe = onSnapshot(settingsRef, (docSnap) => {
                    if (docSnap.exists()) {
                        setSettings({ ...DEFAULT_SETTINGS, ...docSnap.data() });
                    } else {
                        setDoc(settingsRef, DEFAULT_SETTINGS).catch(err => {
                            console.warn("Using default settings (Server sync skipped):", err.code);
                        });
                    }
                }, (error) => {
                    console.warn("Settings fetch warning:", error.code);
                });
                return () => unsubscribe();
            }, [user]);

            // Fetch Donations
            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'donations')); 
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    docs.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));
                    setDonations(docs);
                    setLoading(false);
                }, (error) => {
                    console.error("Donations fetch error:", error);
                    setLoading(false); 
                });
                return () => unsubscribe();
            }, [user]);

            const handleAddDonation = async (newDonation) => {
                if (!user) return;
                try {
                    await addDoc(collection(db, 'donations'), newDonation);
                    showNotification('บันทึกข้อมูลสำเร็จ');
                } catch (e) {
                    console.error(e);
                    showNotification("บันทึกไม่สำเร็จ (ตรวจสอบสิทธิ์การใช้งาน)", 'error');
                }
            };

            const handleUpdateDonation = async (updatedDonation) => {
                if (!user) return;
                try {
                    const { id, ...data } = updatedDonation;
                    await updateDoc(doc(db, 'donations', id), data);
                    showNotification('อัปเดตข้อมูลสำเร็จ');
                } catch (e) {
                    showNotification("แก้ไขไม่สำเร็จ: " + e.message, 'error');
                }
            };

            const handleUpdateSettings = async (newSettings) => {
                if (!user) return;
                try {
                    await setDoc(doc(db, 'settings', 'config'), newSettings);
                    showNotification('บันทึกการตั้งค่าระบบเรียบร้อย');
                } catch (e) {
                    showNotification("ตั้งค่าไม่สำเร็จ: " + e.message, 'error');
                }
            };

            const handleClearAllData = async () => {
                if (!user) return;
                try {
                    const q = query(collection(db, 'donations'));
                    const snapshot = await getDocs(q);
                    const batch = writeBatch(db);
                    snapshot.docs.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                    showNotification('ล้างข้อมูลการบริจาคทั้งหมดเรียบร้อยแล้ว');
                } catch (e) {
                    showNotification("ล้างข้อมูลไม่สำเร็จ: " + e.message, 'error');
                }
            };

            return (
                <div className={`font-sans text-gray-800`}>
                    <style>{`
                        @import url('https://fonts.googleapis.com/css2?family=${settings.fontFamily || 'Prompt'}:wght@300;400;500;600;700&display=swap');
                        :root { --font-dynamic: '${settings.fontFamily || 'Prompt'}', sans-serif; }
                        body, button, input, select, textarea, h1, h2, h3, h4, h5, h6, p, span, a, div, .font-sans { font-family: var(--font-dynamic) !important; }
                    `}</style>

                    {notification && (<NotificationToast msg={notification.msg} type={notification.type} onClose={() => setNotification(null)} />)}
                    
                    {loading ? (
                        <div className="min-h-screen flex flex-col items-center justify-center bg-gray-50 text-gray-600">
                            <Loader className="w-10 h-10 animate-spin mb-4" />
                            <p>กำลังเชื่อมต่อฐานข้อมูล...</p>
                        </div>
                    ) : currentRoute === 'donate-system' ? (
                        <DonationSystem 
                            onBack={() => setCurrentRoute('home')} 
                            donations={donations}
                            settings={settings}
                            onAdd={handleAddDonation}
                            onUpdate={handleUpdateDonation}
                            onUpdateSettings={handleUpdateSettings}
                            onClearData={handleClearAllData}
                            showNotification={showNotification}
                            user={user}
                        />
                    ) : (
                        <OfficialWebsite 
                            onNavigate={(route) => setCurrentRoute(route)} 
                            donations={donations} 
                            settings={settings}
                        />
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
