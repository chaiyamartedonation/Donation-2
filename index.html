<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå (‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ô‡∏õ‡πà‡∏≤‡πÅ‡∏¢‡πâ) - ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</title>
    
    <!-- ==========================================
         LIBRARIES & RESOURCES
    ========================================== -->
    <!-- Google Fonts: Sarabun -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                    },
                    colors: {
                        temple: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12',
                            950: '#431407',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fafc;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Glassmorphism Effect */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Hide Scrollbar but allow scrolling */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            body {
                background: white;
                font-size: 12pt;
            }
            .print-container {
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
                border: none;
            }
            /* Force background colors */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // ==========================================
        // 1. MODULE IMPORTS
        // ==========================================
        import React, { useState, useEffect, useMemo, useRef, createContext, useContext } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        
        // Lucide Icons
        import { 
            Home, PlusCircle, ClipboardList, CheckCircle, User, ShieldCheck, Filter, 
            Check, X, ArrowLeft, HeartHandshake, MapPin, Phone, Calendar, BookOpen, 
            Menu, ChevronRight, Download, Printer, Lock, LogOut, FileText, Megaphone, 
            Mic, RotateCcw, CalendarDays, Pencil, Save, Key, QrCode, ShoppingBag, 
            UploadCloud, Image as ImageIcon, Loader, Maximize2, LogIn, Trash2, Edit, 
            Plus, AlertTriangle, Settings, Power, RefreshCw, AlertOctagon, ChevronDown, Database
        } from 'https://esm.sh/lucide-react@0.344.0';

        // Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, setDoc, doc, onSnapshot, query, deleteDoc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // ==========================================
        // 2. CONFIGURATION & SETUP
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAHuvRRTNpYuh8MFiIwN4Lm106l09BED14",
            authDomain: "donation-1b152.firebaseapp.com",
            projectId: "donation-1b152",
            storageBucket: "donation-1b152.firebasestorage.app",
            messagingSenderId: "203853712269",
            appId: "1:203853712269:web:80441cd834e7b0e68dcbc4",
            measurementId: "G-10ZKFX0TET"
        };

        let app, auth, db, appId = 'temple-donation-app';
        
        // Initialize Firebase safely
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log("Firebase initialized successfully");
        } catch (e) {
            console.error("Firebase Initialization Error:", e);
        }

        // ==========================================
        // 3. UTILITY FUNCTIONS
        // ==========================================
        
        // Image Resize Helper (Client-side compression)
        const resizeImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 800; // Resize to max 800px width
                        const scaleSize = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7)); // Compress to 70% quality
                    };
                };
            });
        };

        // Toast Context for Global Notifications
        const ToastContext = createContext();
        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = useState([]);

            const addToast = (msg, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, msg, type }]);
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== id));
                }, 3000);
            };

            return (
                <ToastContext.Provider value={addToast}>
                    {children}
                    <div className="fixed bottom-4 right-4 z-[9999] flex flex-col gap-2">
                        {toasts.map(t => (
                            <div key={t.id} className={`flex items-center px-4 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 animate-slide-up ${
                                t.type === 'success' ? 'bg-green-600' : 
                                t.type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                            }`}>
                                {t.type === 'success' ? <CheckCircle className="w-5 h-5 mr-2"/> : <AlertTriangle className="w-5 h-5 mr-2"/>}
                                {t.msg}
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        };
        const useToast = () => useContext(ToastContext);

        // ==========================================
        // 4. SHARED COMPONENTS
        // ==========================================

        const PermissionErrorScreen = ({ onUseDemo }) => {
            const rulesSnippet = `rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /artifacts/temple-donation-app/{document=**} {
      allow read, write: if true;
    }
  }
}`;
            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-gray-100 p-4">
                    <div className="bg-white p-8 rounded-xl shadow-xl max-w-lg w-full text-center border-t-4 border-red-500">
                        <AlertTriangle className="w-16 h-16 text-red-500 mx-auto mb-4" />
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</h2>
                        <p className="text-gray-600 mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ (Permission Denied)<br/>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ <strong>Firestore Rules</strong> ‡πÉ‡∏ô Firebase Console</p>
                        
                        <div className="bg-gray-800 text-left text-green-400 p-4 rounded-lg text-xs font-mono mb-6 overflow-x-auto whitespace-pre-wrap">
                            {rulesSnippet}
                        </div>
                        
                        <div className="flex flex-col sm:flex-row gap-3 justify-center">
                            <button onClick={() => window.location.reload()} className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                                <RefreshCw className="w-4 h-4 inline mr-2"/> ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                            </button>
                            <button onClick={onUseDemo} className="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300 transition">
                                <Database className="w-4 h-4 inline mr-2"/> ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï (Offline)
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginModal = ({ role, onClose, onLoginSuccess }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const toast = useToast();
            
            const handleSubmit = (e) => { 
                e.preventDefault(); 
                
                let targetRole = role;
                // If role is generic, determine by password
                if (!targetRole) {
                    if (password === '104') targetRole = 'staff';
                    else if (password === 'admin104') targetRole = 'admin';
                }

                if ((targetRole === 'staff' && password === '104') || (targetRole === 'admin' && password === 'admin104')) {
                    onLoginSuccess(targetRole);
                    toast(`‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${targetRole === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà'}`);
                } else {
                    setError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                }
            };

            return (
                <div className="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 relative">
                        <div className="flex justify-between items-center mb-6 pb-2 border-b border-gray-100">
                            <h3 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <Lock className="w-5 h-5 text-temple-600"/> 
                                {role ? `‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (${role})` : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà'}
                            </h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition"><X className="w-6 h-6" /></button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                <div className="relative">
                                    <Key className="absolute left-3 top-3 w-5 h-5 text-gray-400"/>
                                    <input 
                                        type="password" 
                                        className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-300 rounded-xl outline-none focus:ring-2 focus:ring-temple-500 focus:border-transparent transition" 
                                        placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô..."
                                        value={password} 
                                        onChange={(e) => setPassword(e.target.value)} 
                                        autoFocus 
                                    />
                                </div>
                                {error && <p className="text-red-500 text-sm mt-2 flex items-center"><AlertTriangle className="w-4 h-4 mr-1"/> {error}</p>}
                            </div>
                            <button type="submit" className="w-full bg-gradient-to-r from-temple-600 to-temple-500 hover:from-temple-700 hover:to-temple-600 text-white font-bold py-3 rounded-xl shadow-lg transition transform active:scale-95">
                                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                            </button>
                        </form>
                        <div className="mt-4 text-center text-xs text-gray-400">
                            ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: 104 | ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö: admin104
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 5. FEATURE COMPONENTS
        // ==========================================

        const NewsModal = ({ item, onClose, onSave }) => {
            const [formData, setFormData] = useState(item || { 
                title: '', 
                date: new Date().toISOString().split('T')[0], 
                description: '', 
                tag: '‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', 
                imageUrl: '' 
            });
            const [isUploading, setIsUploading] = useState(false);
            
            const handleFileChange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    setIsUploading(true);
                    try { 
                        const resized = await resizeImage(file); 
                        setFormData({...formData, imageUrl: resized}); 
                    } catch { 
                        alert("Error reading image"); 
                    }
                    setIsUploading(false);
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in">
                    <div className="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-4 pb-2 border-b">
                            <h3 className="text-xl font-bold text-gray-900">{item ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà'}</h3>
                            <button onClick={onClose}><X className="w-6 h-6 text-gray-400 hover:text-gray-600" /></button>
                        </div>
                        <form onSubmit={(e) => { e.preventDefault(); onSave(formData); }} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                                <input type="text" required className="w-full p-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                    <input type="date" required className="w-full p-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö (Tag)</label>
                                    <input type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ" className="w-full p-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.tag} onChange={e => setFormData({...formData, tag: e.target.value})} />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                <textarea rows="4" required className="w-full p-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})}></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</label>
                                <label className="cursor-pointer block border-2 border-dashed border-gray-300 rounded-lg p-6 hover:bg-gray-50 transition text-center">
                                    <div className="flex flex-col items-center justify-center">
                                        {isUploading ? <Loader className="w-8 h-8 animate-spin text-gray-400" /> : <UploadCloud className="w-8 h-8 text-gray-400 mb-2" />}
                                        <span className="text-sm text-gray-500">{formData.imageUrl ? '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û' : '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'}</span>
                                    </div>
                                    <input type="file" accept="image/*" className="hidden" onChange={handleFileChange} />
                                </label>
                                {formData.imageUrl && (
                                    <div className="mt-3 relative inline-block group">
                                        <img src={formData.imageUrl} alt="Preview" className="h-32 rounded-lg border object-cover" />
                                        <button type="button" onClick={() => setFormData({...formData, imageUrl: ''})} className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 transition"><X className="w-4 h-4" /></button>
                                    </div>
                                )}
                            </div>
                            <div className="pt-2">
                                <button type="submit" disabled={isUploading} className="w-full bg-temple-600 hover:bg-temple-700 text-white font-bold py-3 rounded-lg shadow transition flex items-center justify-center">
                                    <Save className="w-5 h-5 mr-2" /> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const NewsSection = ({ userRole, user, demoMode, localNews, setLocalNews }) => {
            const [newsList, setNewsList] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showModal, setShowModal] = useState(false);
            const [editItem, setEditItem] = useState(null);
            const toast = useToast();

            useEffect(() => {
                if (demoMode) { 
                    setNewsList(localNews || []); 
                    setLoading(false); 
                    return; 
                }
                
                if (!db || !user) return;
                
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'news'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    // Sort news by date descending
                    docs.sort((a, b) => new Date(b.date) - new Date(a.date));
                    setNewsList(docs);
                    setLoading(false);
                }, (error) => {
                    console.error("News load error:", error);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user, demoMode, localNews]);

            const handleDelete = async (id) => {
                if(!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
                
                if(demoMode) { 
                    setLocalNews(prev => prev.filter(n => n.id !== id)); 
                    toast("‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (Demo)");
                    return; 
                }
                
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'news', id));
                    toast("‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
                } catch (e) {
                    toast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö", "error");
                }
            };

            const handleSave = async (formData) => {
                if (demoMode) {
                    if(formData.id) {
                        setLocalNews(prev => prev.map(n => n.id === formData.id ? formData : n));
                    } else {
                        setLocalNews(prev => [{...formData, id: Date.now().toString()}, ...prev]);
                    }
                    toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (Demo)");
                } else {
                    try {
                        if (formData.id) { 
                            const { id, ...data } = formData; 
                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'news', id), data); 
                        } else { 
                            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'news'), formData); 
                        }
                        toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
                    } catch (e) { 
                        toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message, "error"); 
                    }
                }
                setShowModal(false);
            };

            return (
                <section id="events" className="py-20 bg-orange-50">
                    <div className="max-w-7xl mx-auto px-4">
                        <div className="text-center mb-16">
                            <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞<span className="text-orange-600">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏∏‡∏ç</span></h2>
                            <p className="text-gray-600 max-w-2xl mx-auto">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏ç ‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå</p>
                            {(userRole === 'admin' || userRole === 'staff') && (
                                <button 
                                    onClick={() => { setEditItem(null); setShowModal(true); }} 
                                    className="mt-6 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-bold inline-flex items-center shadow-lg transition transform hover:scale-105"
                                >
                                    <Plus className="w-5 h-5 mr-2" /> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
                                </button>
                            )}
                        </div>

                        {loading ? (
                            <div className="text-center text-gray-500 py-10"><Loader className="w-10 h-10 animate-spin mx-auto mb-3 text-temple-500"/> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£...</div>
                        ) : newsList.length === 0 ? (
                            <div className="text-center text-gray-400 py-16 border-2 border-dashed border-gray-300 rounded-2xl bg-white/50">
                                <FileText className="w-12 h-12 mx-auto mb-2 opacity-30"/>
                                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
                                {(userRole === 'admin' || userRole === 'staff') && <p className="text-sm mt-1">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå</p>}
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                {newsList.map(news => (
                                    <div key={news.id} className="bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 flex flex-col h-full relative group">
                                        {(userRole === 'admin' || userRole === 'staff') && (
                                            <div className="absolute top-3 right-3 z-10 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                                <button onClick={() => { setEditItem(news); setShowModal(true); }} className="bg-white text-blue-600 p-2 rounded-full shadow-md hover:bg-blue-50 transition"><Edit className="w-4 h-4"/></button>
                                                <button onClick={() => handleDelete(news.id)} className="bg-white text-red-600 p-2 rounded-full shadow-md hover:bg-red-50 transition"><Trash2 className="w-4 h-4"/></button>
                                            </div>
                                        )}
                                        <div className="h-56 bg-gray-200 overflow-hidden relative">
                                            {news.imageUrl ? (
                                                <img src={news.imageUrl} alt={news.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
                                            ) : (
                                                <div className="w-full h-full flex items-center justify-center bg-gray-100 text-gray-400"><ImageIcon className="w-16 h-16 opacity-30" /></div>
                                            )}
                                            {news.tag && (
                                                <div className="absolute top-3 left-3 bg-white/90 backdrop-blur-sm text-orange-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm border border-orange-100">
                                                    {news.tag}
                                                </div>
                                            )}
                                        </div>
                                        <div className="p-6 flex flex-col flex-grow">
                                            <div className="flex items-center text-sm text-gray-500 mb-3 font-medium">
                                                <Calendar className="w-4 h-4 mr-2 text-orange-500" /> 
                                                {new Date(news.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}
                                            </div>
                                            <h3 className="text-xl font-bold text-gray-800 mb-3 leading-snug group-hover:text-temple-600 transition-colors">{news.title}</h3>
                                            <p className="text-gray-600 mb-4 line-clamp-3 flex-grow text-sm leading-relaxed">{news.description}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    
                    {/* Render Modal if open */}
                    {showModal && (
                        <NewsModal 
                            item={editItem} 
                            onClose={() => setShowModal(false)} 
                            onSave={handleSave} 
                        />
                    )}
                </section>
            );
        };

        // ==========================================
        // 6. BACK-OFFICE COMPONENTS
        // ==========================================

        const SettingsPanel = ({ config, onSave, onResetDatabase }) => {
            const [data, setData] = useState(config);
            const handleChange = (key, value) => setData({ ...data, [key]: value });
            
            const confirmReset = () => { 
                if (confirm('‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n(‡∏Ñ‡∏ß‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)')) {
                    if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ')) {
                        onResetDatabase(); 
                    }
                }
            };

            return (
                <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-md overflow-hidden animate-fade-in">
                    <div className="bg-gray-50 px-6 py-4 border-b border-gray-200">
                        <h2 className="text-xl font-bold flex items-center text-gray-800"><Settings className="w-6 h-6 mr-2 text-gray-600"/> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h2>
                        <p className="text-sm text-gray-500 mt-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                    <div className="p-8 space-y-8">
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ)</label>
                            <input 
                                type="text" 
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temple-500 outline-none transition" 
                                value={data.eventName} 
                                onChange={(e) => handleChange('eventName', e.target.value)} 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç‡∏ó‡∏≠‡∏î‡∏Å‡∏ê‡∏¥‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ" 
                            />
                            <p className="text-xs text-gray-500 mt-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</p>
                        </div>

                        <div className="flex items-center justify-between bg-orange-50 p-5 rounded-xl border border-orange-100">
                            <div>
                                <label className="block text-sm font-bold text-gray-800">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</label>
                                <p className="text-xs text-gray-600 mt-1">‡∏´‡∏≤‡∏Å‡∏õ‡∏¥‡∏î ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÅ‡∏ï‡πà‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ)</p>
                            </div>
                            <label className="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" className="sr-only peer" checked={data.isOnline} onChange={(e) => handleChange('isOnline', e.target.checked)} />
                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
                            </label>
                        </div>

                        <button 
                            onClick={() => onSave(data)} 
                            className="w-full bg-temple-600 hover:bg-temple-700 text-white font-bold py-3 rounded-lg shadow-md transition transform active:scale-95 flex items-center justify-center"
                        >
                            <Save className="w-5 h-5 mr-2" /> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>

                        <hr className="border-gray-200" />

                        <div className="bg-red-50 border border-red-200 rounded-xl p-5">
                            <div className="flex items-start gap-4">
                                <div className="bg-red-100 p-3 rounded-full flex-shrink-0"><AlertOctagon className="w-6 h-6 text-red-600" /></div>
                                <div>
                                    <h3 className="text-red-800 font-bold text-lg">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏ç‡πÉ‡∏´‡∏°‡πà (‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤)</h3>
                                    <p className="text-sm text-red-700 mt-2 leading-relaxed">
                                        ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏ç‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡πÉ‡∏´‡∏°‡πà 
                                        <br/><strong className="underline">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÇ‡∏õ‡∏£‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Excel/CSV) ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ
                                    </p>
                                    <button 
                                        onClick={confirmReset} 
                                        className="mt-4 bg-white border border-red-300 text-red-600 hover:bg-red-600 hover:text-white px-5 py-2.5 rounded-lg text-sm font-bold transition flex items-center shadow-sm"
                                    >
                                        <Trash2 className="w-4 h-4 mr-2" /> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const EditModal = ({ donation, userRole, onClose, onSave }) => {
            const [formData, setFormData] = useState({ ...donation });
            const [securityCode, setSecurityCode] = useState('');
            const [error, setError] = useState('');
            const toast = useToast();

            const handleSave = () => {
                if (!formData.name) return setError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•');
                if (!formData.amount || formData.amount < 0) return setError('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                if (userRole === 'staff' && securityCode !== '104') return setError('‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                
                onSave(formData);
                toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl w-full max-w-lg p-6 animate-scale-up max-h-[90vh] overflow-y-auto shadow-2xl">
                        <div className="flex justify-between items-center mb-6 pb-4 border-b">
                            <h3 className="text-xl font-bold text-gray-800 flex items-center"><Pencil className="w-5 h-5 mr-2 text-temple-600" /> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h3>
                            <button onClick={onClose}><X className="w-6 h-6 text-gray-400 hover:text-gray-600 transition"/></button>
                        </div>
                        
                        <div className="space-y-5">
                            <div className="bg-gray-50 p-3 rounded-lg text-xs text-gray-500 font-mono border">ID: {formData.id}</div>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-xs font-bold text-gray-600 mb-1">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</label><input type="datetime-local" className="w-full p-2 border border-gray-300 rounded-lg text-sm" value={formData.dateTime.slice(0,16)} onChange={e => setFormData({...formData, dateTime: e.target.value})} /></div>
                            </div>

                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" className="w-full p-3 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                <input type="text" className="w-full p-3 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.purpose} onChange={e => setFormData({...formData, purpose: e.target.value})} />
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" className="w-full p-3 border border-gray-300 rounded-lg outline-none font-bold text-temple-600 text-right" value={formData.amount} onChange={e => setFormData({...formData, amount: parseFloat(e.target.value)})} />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</label>
                                    <select className="w-full p-3 border border-gray-300 rounded-lg outline-none bg-white" value={formData.method} onChange={e => setFormData({...formData, method: e.target.value})}>
                                        <option value="‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô">‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô</option>
                                        <option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
                                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                    </select>
                                </div>
                            </div>
                            
                            {formData.slipImage && (
                                <div className="mt-2 p-2 border rounded-lg bg-gray-50">
                                    <label className="block text-xs font-bold text-gray-500 mb-2">‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏°‡∏≤</label>
                                    <img src={formData.slipImage} alt="Slip" className="max-h-48 rounded border mx-auto" />
                                </div>
                            )}

                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                                <select className={`w-full p-3 border rounded-lg outline-none font-medium ${formData.status==='approved'?'bg-green-50 border-green-200 text-green-700':formData.status==='rejected'?'bg-red-50 border-red-200 text-red-700':'bg-yellow-50 border-yellow-200 text-yellow-700'}`} value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}>
                                    <option value="pending">üü° ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                                    <option value="approved">üü¢ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                                    <option value="rejected">üî¥ ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                                <textarea rows="2" className="w-full p-3 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-temple-500" value={formData.generalNote || ''} onChange={e => setFormData({...formData, generalNote: e.target.value})} />
                            </div>

                            <hr className="my-4 border-gray-100" />
                            
                            {userRole === 'staff' && (
                                <div className="bg-red-50 border border-red-100 p-4 rounded-xl">
                                    <label className="block text-sm font-bold text-red-700 mb-2 flex items-center">
                                        <Key className="w-4 h-4 mr-2" /> ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                                    </label>
                                    <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (104)" className="w-full p-3 border border-red-200 rounded-lg outline-none focus:ring-2 focus:ring-red-500 bg-white" value={securityCode} onChange={e => setSecurityCode(e.target.value)} />
                                    <p className="text-xs text-red-500 mt-2">* ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</p>
                                </div>
                            )}
                            
                            {error && <div className="text-red-600 text-sm font-bold bg-red-100 p-3 rounded-lg text-center flex items-center justify-center"><AlertTriangle className="w-4 h-4 mr-2"/> {error}</div>}

                            <div className="flex gap-3 pt-2">
                                <button onClick={onClose} className="flex-1 py-3 bg-gray-100 text-gray-600 font-bold rounded-xl hover:bg-gray-200 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                <button onClick={handleSave} className="flex-1 py-3 bg-temple-600 text-white font-bold rounded-xl hover:bg-temple-700 shadow-lg transition transform active:scale-95">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ donations, userRole, onUpdateDonation }) => {
            const [filter, setFilter] = useState('');
            const [edit, setEdit] = useState(null);
            const [viewSlip, setViewSlip] = useState(null);
            
            const filteredList = useMemo(() => {
                return donations
                    .filter(d => (userRole !== 'donor' || d.status === 'approved'))
                    .filter(d => d.name.toLowerCase().includes(filter.toLowerCase()) || d.purpose.toLowerCase().includes(filter.toLowerCase()));
            }, [donations, userRole, filter]);

            const totalAmount = filteredList.reduce((sum, d) => d.status === 'approved' ? sum + d.amount : sum, 0);

            const exportCSV = () => {
                const headers = ["ID", "Date", "Name", "Purpose", "Amount", "Method", "Status", "Note"];
                const rows = filteredList.map(d => [d.id, new Date(d.dateTime).toLocaleString('th-TH'), `"${d.name}"`, `"${d.purpose}"`, d.amount, d.method, d.status, `"${d.generalNote || ''}"`]);
                const csvContent = "data:text/csv;charset=utf-8,\uFEFF" + [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
                const link = document.createElement("a");
                link.href = encodeURI(csvContent);
                link.download = `donation_report_${new Date().toISOString().slice(0,10)}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* Stats Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 no-print">
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition">
                            <div>
                                <p className="text-gray-500 text-sm font-medium mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß)</p>
                                <h3 className="text-3xl font-extrabold text-green-600">{totalAmount.toLocaleString()} ‡∏ø</h3>
                            </div>
                            <div className="p-4 bg-green-50 rounded-2xl"><ClipboardList className="w-8 h-8 text-green-600"/></div>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition">
                            <div>
                                <p className="text-gray-500 text-sm font-medium mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <h3 className="text-3xl font-extrabold text-blue-600">{filteredList.length}</h3>
                            </div>
                            <div className="p-4 bg-blue-50 rounded-2xl"><FileText className="w-8 h-8 text-blue-600"/></div>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition">
                            <div>
                                <p className="text-gray-500 text-sm font-medium mb-1">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                                <h3 className="text-3xl font-extrabold text-orange-500">{filteredList.filter(d=>d.status==='pending').length}</h3>
                            </div>
                            <div className="p-4 bg-orange-50 rounded-2xl"><ShieldCheck className="w-8 h-8 text-orange-500"/></div>
                        </div>
                    </div>

                    {/* Toolbar */}
                    <div className="flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-100 no-print">
                        <div className="relative w-full md:w-80">
                            <Search className="absolute left-3 top-3 w-5 h-5 text-gray-400"/>
                            <input 
                                type="text" 
                                placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." 
                                className="w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-temple-400 transition"
                                value={filter}
                                onChange={e => setFilter(e.target.value)}
                            />
                        </div>
                        <div className="flex gap-3 w-full md:w-auto">
                            <button onClick={() => window.print()} className="flex-1 md:flex-none flex items-center justify-center px-4 py-2.5 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm font-bold text-gray-700 transition">
                                <Printer className="w-4 h-4 mr-2"/> ‡∏û‡∏¥‡∏°‡∏û‡πå
                            </button>
                            <button onClick={exportCSV} className="flex-1 md:flex-none flex items-center justify-center px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-xl text-sm font-bold transition shadow-sm">
                                <Download className="w-4 h-4 mr-2"/> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
                            </button>
                        </div>
                    </div>

                    {/* Data Table */}
                    <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden print-container">
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-gray-50 text-gray-600 font-bold border-b border-gray-100">
                                    <tr>
                                        <th className="p-4 whitespace-nowrap">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà / ‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th className="p-4">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</th>
                                        <th className="p-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                        <th className="p-4 text-right">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                                        <th className="p-4 text-center">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
                                        <th className="p-4 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th className="p-4 text-center no-print">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-50">
                                    {filteredList.length === 0 ? (
                                        <tr><td colSpan="7" className="p-10 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
                                    ) : filteredList.map(d => (
                                        <tr key={d.id} className="hover:bg-gray-50 transition group">
                                            <td className="p-4 whitespace-nowrap text-gray-500">{new Date(d.dateTime).toLocaleDateString('th-TH', {day:'2-digit', month:'2-digit', year:'2-digit', hour:'2-digit', minute:'2-digit'})}</td>
                                            <td className="p-4 font-bold text-gray-800">{d.name}</td>
                                            <td className="p-4 text-gray-600 max-w-xs truncate" title={d.purpose}>{d.purpose}</td>
                                            <td className="p-4 text-right font-bold text-temple-600">{d.amount.toLocaleString()}</td>
                                            <td className="p-4 text-center">
                                                {d.slipImage ? 
                                                    <button onClick={() => setViewSlip(d.slipImage)} className="text-blue-500 hover:text-blue-700 transition"><ImageIcon className="w-5 h-5 mx-auto"/></button> : 
                                                    <span className="text-gray-300">-</span>
                                                }
                                            </td>
                                            <td className="p-4 text-center">
                                                <span className={`px-3 py-1 rounded-full text-xs font-bold border ${
                                                    d.status === 'approved' ? 'bg-green-50 text-green-700 border-green-200' :
                                                    d.status === 'rejected' ? 'bg-red-50 text-red-700 border-red-200' :
                                                    'bg-yellow-50 text-yellow-700 border-yellow-200'
                                                }`}>
                                                    {d.status === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : d.status === 'rejected' ? '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò' : '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à'}
                                                </span>
                                            </td>
                                            <td className="p-4 text-center no-print">
                                                {userRole !== 'donor' && (
                                                    <button onClick={() => setEdit(d)} className="p-2 text-gray-400 hover:text-temple-600 hover:bg-temple-50 rounded-full transition">
                                                        <Pencil className="w-4 h-4" />
                                                    </button>
                                                )}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    {/* Modals */}
                    {edit && <EditModal donation={edit} userRole={userRole} onClose={() => setEdit(null)} onSave={onUpdateDonation} />}
                    {viewSlip && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 animate-fade-in" onClick={() => setViewSlip(null)}>
                            <div className="relative">
                                <img src={viewSlip} className="max-h-[90vh] max-w-full rounded-lg shadow-2xl" />
                                <button className="absolute -top-10 right-0 text-white hover:text-gray-300"><X className="w-8 h-8"/></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const ApprovalPanel = ({ donations, onApprove, onReject }) => {
            const pending = useMemo(() => donations.filter(d => d.status === 'pending'), [donations]);
            const [viewSlip, setViewSlip] = useState(null);

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="flex items-center space-x-3 mb-6">
                        <div className="bg-orange-100 p-2 rounded-full"><ShieldCheck className="w-6 h-6 text-temple-600"/></div>
                        <h2 className="text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ({pending.length})</h2>
                    </div>

                    {pending.length === 0 ? (
                        <div className="text-center py-20 bg-white rounded-2xl shadow-sm border border-gray-100">
                            <div className="bg-green-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <CheckCircle className="w-10 h-10 text-green-500"/>
                            </div>
                            <h3 className="text-lg font-bold text-gray-700">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3>
                            <p className="text-gray-500">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö!</p>
                        </div>
                    ) : (
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {pending.map(d => (
                                <div key={d.id} className="bg-white rounded-2xl shadow-md border border-orange-100 overflow-hidden flex flex-col hover:-translate-y-1 transition duration-300">
                                    <div className="p-4 border-b border-gray-50 bg-gray-50/50 flex justify-between items-start">
                                        <div>
                                            <div className="text-xs text-gray-400 font-mono mb-1">{new Date(d.dateTime).toLocaleString('th-TH')}</div>
                                            <h3 className="font-bold text-gray-800 text-lg line-clamp-1" title={d.name}>{d.name}</h3>
                                        </div>
                                        {d.slipImage && (
                                            <button onClick={() => setViewSlip(d.slipImage)} className="bg-blue-50 text-blue-600 p-2 rounded-lg hover:bg-blue-100 transition shadow-sm" title="‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ">
                                                <ImageIcon className="w-4 h-4"/>
                                            </button>
                                        )}
                                    </div>
                                    <div className="p-5 flex-grow space-y-3">
                                        <div className="flex justify-between items-center text-sm">
                                            <span className="text-gray-500">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</span>
                                            <span className="text-2xl font-bold text-temple-600">{d.amount.toLocaleString()} ‡∏ø</span>
                                        </div>
                                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                            <span className="text-xs text-gray-400 block mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span>
                                            <p className="text-sm text-gray-700 line-clamp-3">{d.purpose}</p>
                                        </div>
                                        <div className="flex justify-between items-center text-xs text-gray-500 pt-2 border-t border-gray-100">
                                            <span className="flex items-center"><User className="w-3 h-3 mr-1"/> {d.source === 'self' ? '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏≠‡∏á' : '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà'}</span>
                                            <span className="bg-gray-100 px-2 py-0.5 rounded">{d.method}</span>
                                        </div>
                                    </div>
                                    <div className="p-4 bg-gray-50 flex gap-3">
                                        <button onClick={() => onApprove(d.id)} className="flex-1 bg-green-500 hover:bg-green-600 text-white py-2.5 rounded-xl font-bold shadow-md transition flex items-center justify-center">
                                            <Check className="w-4 h-4 mr-1"/> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                        </button>
                                        <button onClick={() => onReject(d.id)} className="flex-1 bg-white border border-red-200 text-red-500 hover:bg-red-50 py-2.5 rounded-xl font-bold transition flex items-center justify-center">
                                            <X className="w-4 h-4 mr-1"/> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* View Slip Modal */}
                    {viewSlip && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex justify-center items-center p-4 animate-fade-in" onClick={() => setViewSlip(null)}>
                            <div className="relative max-w-full max-h-full">
                                <img src={viewSlip} className="max-h-[90vh] rounded-lg shadow-2xl object-contain" />
                                <button className="absolute -top-10 right-0 text-white hover:text-gray-300 p-2">
                                    <X className="w-8 h-8"/>
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const AnnouncerPanel = ({ donations, onUpdateStatus }) => {
            const queue = useMemo(() => donations.filter(d => d.status === 'approved' && !d.announced), [donations]);
            const history = useMemo(() => donations.filter(d => d.announced).sort((a,b)=> new Date(b.dateTime) - new Date(a.dateTime)).slice(0, 5), [donations]);
            const current = queue[0];
            const toast = useToast();

            return (
                <div className="grid lg:grid-cols-3 gap-8 h-[calc(100vh-200px)] animate-fade-in">
                    {/* Main Stage */}
                    <div className="lg:col-span-2 bg-white rounded-3xl shadow-xl border border-gray-100 p-8 md:p-12 text-center flex flex-col justify-center relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-temple-400 to-temple-600"></div>
                        
                        {current ? (
                            <div className="animate-scale-up w-full relative z-10">
                                <div className="inline-block bg-temple-50 text-temple-800 px-6 py-2 rounded-full text-sm font-bold mb-8 animate-pulse shadow-sm border border-temple-100">
                                    ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                                </div>
                                <h1 className="text-4xl md:text-6xl font-black text-gray-800 mb-6 leading-tight drop-shadow-sm">{current.name}</h1>
                                
                                <div className="flex flex-col items-center justify-center mb-10">
                                    <span className="text-gray-400 text-sm uppercase tracking-wide mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç</span>
                                    <div className="text-5xl md:text-7xl text-transparent bg-clip-text bg-gradient-to-br from-temple-500 to-temple-700 font-black">
                                        {current.amount.toLocaleString()} <span className="text-2xl text-gray-400 font-medium">‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                </div>
                                
                                <div className="bg-gray-50 rounded-2xl p-8 max-w-3xl mx-auto border border-gray-100 text-left mb-10 shadow-inner">
                                    <div className="mb-6">
                                        <span className="block text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</span>
                                        <p className="text-xl text-gray-700 font-medium leading-relaxed whitespace-pre-wrap">{current.purpose}</p>
                                    </div>
                                    {current.generalNote && (
                                        <div className="pt-6 border-t border-gray-200">
                                            <span className="block text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</span>
                                            <p className="text-2xl italic text-gray-600 font-serif">"{current.generalNote}"</p>
                                        </div>
                                    )}
                                </div>
                                
                                <button 
                                    onClick={() => { onUpdateStatus(current.id, true); toast(`‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ñ‡∏∏‡∏ì ${current.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`); }} 
                                    className="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white text-2xl font-bold py-5 px-16 rounded-full shadow-xl shadow-green-200 transform transition hover:scale-105 active:scale-95 flex items-center mx-auto"
                                >
                                    <Mic className="w-8 h-8 mr-3"/> ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß
                                </button>
                            </div>
                        ) : (
                            <div className="text-gray-300 flex flex-col items-center">
                                <div className="bg-gray-50 p-8 rounded-full mb-6 shadow-inner">
                                    <CheckCircle className="w-24 h-24 opacity-20"/>
                                </div>
                                <h3 className="text-3xl font-bold text-gray-400">‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</h3>
                                <p className="mt-3 text-lg text-gray-400 font-light">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
                            </div>
                        )}
                    </div>
                    
                    {/* Sidebar History */}
                    <div className="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden flex flex-col h-full">
                        <div className="bg-gray-50 p-5 border-b border-gray-200 flex justify-between items-center">
                            <h3 className="font-bold text-gray-700 flex items-center"><RotateCcw className="w-4 h-4 mr-2"/> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
                            <span className="text-xs font-bold bg-white border px-2 py-1 rounded text-gray-500">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                        
                        <div className="flex-grow overflow-y-auto p-4 space-y-3">
                            {history.length === 0 && <div className="text-center py-20 text-gray-300 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</div>}
                            {history.map(d => (
                                <div key={d.id} className="p-4 bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition flex justify-between items-center group">
                                    <div className="overflow-hidden mr-3">
                                        <div className="font-bold text-gray-800 truncate text-base">{d.name}</div>
                                        <div className="text-xs text-gray-500 flex items-center mt-1">
                                            <span className="font-bold text-temple-600 mr-2">{d.amount.toLocaleString()} ‡∏ø</span>
                                            <span>‚Ä¢ {new Date(d.dateTime).toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'})}</span>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => { onUpdateStatus(d.id, false); toast("‡∏ô‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà"); }} 
                                        className="p-2 text-gray-300 hover:text-temple-600 hover:bg-temple-50 rounded-full transition" 
                                        title="‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà"
                                    >
                                        <RotateCcw className="w-5 h-5"/>
                                    </button>
                                </div>
                            ))}
                        </div>
                        
                        <div className="p-4 bg-gray-50 border-t border-gray-200">
                            <div className="flex justify-between items-center text-sm font-medium text-gray-600">
                                <span>‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®:</span>
                                <span className="bg-temple-600 text-white px-3 py-1 rounded-full text-xs">{queue.length} ‡∏ó‡πà‡∏≤‡∏ô</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 7. MAIN APP LAYOUTS & ROUTING
        // ==========================================

        const OfficialWebsite = ({ onNavigate, donations, userRole, setUserRole, user }) => {
            const total = useMemo(() => donations.filter(d => d.status === 'approved').reduce((sum, d) => sum + d.amount, 0), [donations]);
            const [isScrolled, setIsScrolled] = useState(false);
            const [mobileMenu, setMobileMenu] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const toast = useToast();
            
            useEffect(() => {
                const onScroll = () => setIsScrolled(window.scrollY > 20);
                window.addEventListener('scroll', onScroll);
                return () => window.removeEventListener('scroll', onScroll);
            }, []);

            const scrollTo = (id) => {
                const element = document.getElementById(id);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                    setMobileMenu(false);
                }
            };

            return (
                <div className="min-h-screen bg-white font-sans text-gray-800">
                    {/* Navigation */}
                    <nav className={`fixed w-full z-40 transition-all duration-300 ${isScrolled ? 'bg-white/95 backdrop-blur-md shadow-md py-2' : 'bg-transparent py-4'}`}>
                        <div className="max-w-7xl mx-auto px-4 flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => scrollTo('home')}>
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${isScrolled ? 'bg-temple-600 text-white' : 'bg-white text-temple-600 shadow-lg'}`}>
                                    <BookOpen className="w-6 h-6"/>
                                </div>
                                <span className={`text-xl font-bold tracking-tight ${isScrolled ? 'text-gray-800' : 'text-white drop-shadow-md'}`}>‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå</span>
                            </div>
                            
                            <div className={`hidden md:flex gap-8 font-medium ${isScrolled ? 'text-gray-600' : 'text-white/90'}`}>
                                {['‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å', '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠'].map(m => (
                                    <button key={m} onClick={() => scrollTo(m === '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å' ? 'home' : m === '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°' ? 'events' : m)} className="hover:text-temple-500 transition relative group">
                                        {m}
                                        <span className="absolute -bottom-1 left-0 w-0 h-0.5 bg-temple-500 transition-all group-hover:w-full"></span>
                                    </button>
                                ))}
                            </div>
                            
                            <div className="flex gap-3 items-center">
                                <button 
                                    onClick={() => onNavigate('donate-system')} 
                                    className={`px-6 py-2.5 rounded-full font-bold shadow-lg transition transform hover:scale-105 flex items-center ${isScrolled ? 'bg-temple-600 text-white hover:bg-temple-700' : 'bg-white text-temple-600 hover:bg-gray-100'}`}
                                >
                                    <HeartHandshake className="w-4 h-4 mr-2" /> ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç
                                </button>
                                
                                {userRole === 'donor' ? (
                                    <button 
                                        onClick={() => setShowLogin(true)} 
                                        className={`p-2.5 rounded-full hover:bg-white/20 transition ${isScrolled ? 'text-gray-400 hover:text-gray-600 hover:bg-gray-100' : 'text-white/80 hover:text-white'}`}
                                        title="‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà"
                                    >
                                        <Lock className="w-5 h-5"/>
                                    </button>
                                ) : (
                                    <button 
                                        onClick={() => {if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) { setUserRole('donor'); toast("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß"); }}} 
                                        className="flex items-center px-3 py-1.5 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition border border-red-100"
                                    >
                                        <LogOut className="w-3 h-3 mr-1"/> {userRole === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•' : '‡∏à‡∏ô‡∏ó.'}
                                    </button>
                                )}
                                
                                <button className={`md:hidden ${isScrolled ? 'text-gray-800' : 'text-white'}`} onClick={() => setMobileMenu(!mobileMenu)}>
                                    <Menu className="w-6 h-6"/>
                                </button>
                            </div>
                        </div>
                    </nav>
                    
                    {/* Mobile Menu Overlay */}
                    {mobileMenu && (
                        <div className="fixed inset-0 z-30 bg-black/50 backdrop-blur-sm md:hidden" onClick={() => setMobileMenu(false)}>
                            <div className="absolute top-0 right-0 w-64 h-full bg-white shadow-2xl p-6 animate-fade-in" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-8">
                                    <span className="font-bold text-lg text-gray-800">‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</span>
                                    <button onClick={() => setMobileMenu(false)}><X className="w-6 h-6 text-gray-400"/></button>
                                </div>
                                <div className="flex flex-col gap-4">
                                    {['‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å', '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠'].map(m => (
                                        <button key={m} onClick={() => scrollTo(m === '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å' ? 'home' : m === '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°' ? 'events' : m)} className="text-left text-gray-600 font-medium hover:text-temple-600 py-2 border-b border-gray-100">
                                            {m}
                                        </button>
                                    ))}
                                    <button onClick={() => onNavigate('donate-system')} className="mt-4 w-full bg-temple-600 text-white py-3 rounded-xl font-bold shadow-lg">‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Hero Section */}
                    <header id="home" className="relative h-[90vh] flex items-center justify-center bg-gray-900 overflow-hidden">
                        <div className="absolute inset-0 z-0">
                            <img src="https://img2.pic.in.th/IMG_2659.jpg" className="w-full h-full object-cover opacity-50 animate-scale-up" />
                            <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-black/60"></div>
                        </div>
                        
                        <div className="relative z-10 text-center text-white px-4 max-w-5xl mx-auto">
                            <span className="inline-block py-1.5 px-4 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-sm font-medium mb-6 animate-fade-in tracking-wide">
                                ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏ä‡∏≤‡∏ß‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏ó‡∏≠‡∏á ‡∏≠.‡∏™‡∏π‡∏á‡πÄ‡∏°‡πà‡∏ô ‡∏à.‡πÅ‡∏û‡∏£‡πà
                            </span>
                            <h1 className="text-5xl md:text-7xl lg:text-8xl font-black mb-6 drop-shadow-2xl leading-tight tracking-tight">
                                ‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå<br/>
                                <span className="text-transparent bg-clip-text bg-gradient-to-r from-temple-300 via-temple-100 to-temple-300 text-4xl md:text-6xl font-serif mt-2 block">(‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ô‡∏õ‡πà‡∏≤‡πÅ‡∏¢‡πâ)</span>
                            </h1>
                            
                            <div className="flex flex-col md:flex-row gap-8 justify-center items-center mt-12 animate-slide-up" style={{animationDelay: '0.2s'}}>
                                <div className="glass-panel p-8 rounded-3xl text-center min-w-[300px]">
                                    <p className="text-temple-200 text-xs font-bold uppercase tracking-[0.2em] mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏™‡∏∞‡∏™‡∏°</p>
                                    <div className="text-5xl font-black text-white drop-shadow-md">
                                        {total.toLocaleString()} <span className="text-2xl font-medium text-white/70">‡∏ø</span>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => onNavigate('donate-system')} 
                                    className="group relative bg-temple-600 hover:bg-temple-500 text-white px-10 py-5 rounded-full font-bold text-xl shadow-2xl shadow-temple-900/50 transition-all transform hover:-translate-y-1 overflow-hidden"
                                >
                                    <span className="relative z-10 flex items-center"><HeartHandshake className="w-6 h-6 mr-3"/> ‡∏£‡πà‡∏ß‡∏°‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                                </button>
                            </div>
                        </div>
                        
                        <div className="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce">
                            <ChevronDown className="w-8 h-8 text-white/50" />
                        </div>
                    </header>

                    {/* History Section */}
                    <section id="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥" className="py-24 bg-white relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-1/3 h-full bg-temple-50/50 -skew-x-12 translate-x-20"></div>
                        <div className="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-20 items-center relative z-10">
                            <div className="relative group">
                                <div className="absolute -inset-4 bg-temple-100 rounded-[2rem] transform rotate-3 transition duration-500 group-hover:rotate-6"></div>
                                <div className="absolute -inset-4 bg-temple-50 rounded-[2rem] transform -rotate-3 transition duration-500 group-hover:-rotate-6 scale-95"></div>
                                <img src="https://img5.pic.in.th/file/secure-sv1/Gemini_Generated_Image_uwmqsauwmqsauwmq.png" className="relative rounded-2xl shadow-2xl w-full h-auto object-cover transform transition duration-500 group-hover:-translate-y-2"/>
                            </div>
                            <div>
                                <div className="flex items-center gap-3 text-temple-600 font-bold mb-6 tracking-wide uppercase text-sm">
                                    <span className="w-8 h-0.5 bg-temple-600"></span>
                                    ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤
                                </div>
                                <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 leading-tight">
                                    ‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡∏®‡∏£‡∏±‡∏ó‡∏ò‡∏≤‡πÅ‡∏´‡πà‡∏á<br/><span className="text-temple-600">‡∏•‡∏∏‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏¢‡∏°</span>
                                </h2>
                                <div className="space-y-6 text-gray-600 text-lg leading-relaxed text-justify">
                                    <p>
                                        ‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå ‡πÄ‡∏î‡∏¥‡∏°‡∏ä‡∏∑‡πà‡∏≠ <strong>"‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ô‡∏õ‡πà‡∏≤‡πÅ‡∏¢‡πâ"</strong> ‡∏Å‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏µ ‡∏û.‡∏®. ‡πí‡πî‡πë‡πê ‡πÉ‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏£‡∏±‡∏ä‡∏Å‡∏≤‡∏•‡∏ó‡∏µ‡πà ‡πï ‡πÇ‡∏î‡∏¢ <strong>‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå</strong> ‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏û‡∏¢‡∏û‡∏´‡∏ô‡∏µ‡∏†‡∏±‡∏¢‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏ê‡∏≤‡∏ô ‡∏ì ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏ö‡∏™‡∏π‡∏á (‡∏™‡∏±‡∏ô) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏¢‡πâ‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏≤‡∏Å ‡∏à‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ "‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏±‡∏ô‡∏õ‡πà‡∏≤‡πÅ‡∏¢‡πâ"
                                    </p>
                                    <p>
                                        ‡∏ï‡πà‡∏≠‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏Ç‡πá‡∏á ‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡πÉ‡∏à‡∏Å‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏à‡∏¥‡∏ï‡πÉ‡∏à ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏´‡∏≤‡∏£‡πÑ‡∏°‡πâ‡∏™‡∏±‡∏Å‡∏ó‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏ç‡πÄ‡∏ä‡∏¥‡∏ç‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏ô‡∏≤‡∏°‡∏ß‡πà‡∏≤ <strong>"‡∏´‡∏•‡∏ß‡∏á‡∏û‡πà‡∏≠‡πÑ‡∏ä‡∏¢‡∏≤"</strong> ‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡∏≤‡∏ô
                                    </p>
                                    <p>
                                        ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏™‡∏∏‡∏á‡∏Ñ‡∏≤‡∏°‡∏™‡∏µ‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡∏™‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏∞‡∏Ç‡∏≠‡∏á‡∏ä‡∏≤‡∏ß‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏ó‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á ‡∏°‡∏µ‡∏®‡∏£‡∏±‡∏ó‡∏ò‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ß‡∏±‡∏î‡∏Å‡∏ß‡πà‡∏≤ 350 ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏ô
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* News Section (Props passed down) */}
                    <NewsSection userRole={userRole} user={user} demoMode={!user} localNews={[]} setLocalNews={()=>{}} />

                    {/* Footer */}
                    <footer id="contact" className="bg-gray-900 text-white pt-24 pb-12 border-t border-gray-800">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="grid md:grid-cols-3 gap-16 mb-20">
                                <div>
                                    <div className="flex items-center gap-4 mb-8">
                                        <div className="w-12 h-12 bg-temple-600 rounded-full flex items-center justify-center shadow-lg shadow-temple-900/50"><BookOpen className="w-6 h-6"/></div>
                                        <div>
                                            <span className="text-2xl font-bold block leading-none">‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå</span>
                                            <span className="text-xs text-gray-400 font-light tracking-wider">WAT CHAIYA MAT</span>
                                        </div>
                                    </div>
                                    <p className="text-gray-400 leading-relaxed mb-6">
                                        ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏ä‡∏≤‡∏ß‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏ó‡∏≠‡∏á ‡∏™‡∏∑‡∏ö‡∏™‡∏≤‡∏ô‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤ ‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÉ‡∏´‡πâ‡∏£‡πà‡∏°‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏∏‡∏Ç
                                    </p>
                                </div>
                                <div>
                                    <h4 className="text-lg font-bold mb-8 text-white border-l-4 border-temple-600 pl-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h4>
                                    <ul className="space-y-6 text-gray-300">
                                        <li className="flex items-start">
                                            <div className="bg-gray-800 p-2 rounded-lg mr-4"><MapPin className="w-5 h-5 text-temple-500"/></div>
                                            <span className="mt-1">‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1 ‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏ó‡∏≠‡∏á<br/>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏™‡∏π‡∏á‡πÄ‡∏°‡πà‡∏ô ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏û‡∏£‡πà 54130</span>
                                        </li>
                                        <li className="flex items-center">
                                            <div className="bg-gray-800 p-2 rounded-lg mr-4"><Phone className="w-5 h-5 text-temple-500"/></div>
                                            <span className="text-lg font-medium text-white">082-2801992</span>
                                        </li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 className="text-lg font-bold mb-8 text-white border-l-4 border-temple-600 pl-4">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</h4>
                                    <ul className="space-y-4 text-gray-300">
                                        <li className="flex justify-between items-center border-b border-gray-800 pb-3">
                                            <span className="flex items-center"><User className="w-4 h-4 mr-2 text-gray-500"/> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏∞</span> 
                                            <span className="text-white font-medium">06:00 - 18:00 ‡∏ô.</span>
                                        </li>
                                        <li className="flex justify-between items-center border-b border-gray-800 pb-3">
                                            <span className="flex items-center"><Settings className="w-4 h-4 mr-2 text-gray-500"/> ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏î</span> 
                                            <span className="text-white font-medium">08:00 - 17:00 ‡∏ô.</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div className="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center text-gray-500 text-sm">
                                <p>&copy; {new Date().getFullYear()} ‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå. All rights reserved.</p>
                                <div className="flex gap-6 mt-4 md:mt-0">
                                    <a href="#" className="hover:text-white transition">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                                    <a href="#" className="hover:text-white transition">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
                                </div>
                            </div>
                        </div>
                    </footer>

                    {/* Modals */}
                    {showLogin && <LoginModal onClose={()=>setShowLogin(false)} onLoginSuccess={(role)=>{setUserRole(role); setShowLogin(false); toast(`‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ${role} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);}} />}
                </div>
            );
        };

        const DonationSystem = ({ onBack, donations, onAdd, onUpdate, userRole, setUserRole, systemConfig, onUpdateConfig, onResetDatabase, user }) => {
            const [tab, setTab] = useState('donate');
            const [showLogin, setShowLogin] = useState(false);
            const [pendingRole, setPendingRole] = useState(null);
            const toast = useToast();

            const handleRoleChange = (e) => {
                const role = e.target.value;
                if(role === 'donor') { 
                    setUserRole('donor'); 
                    setTab('donate'); 
                    toast("‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ"); 
                } else { 
                    setPendingRole(role); 
                    setShowLogin(true); 
                }
            };

            const handleLogout = () => { setUserRole('donor'); setTab('donate'); toast("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß"); };

            return (
                <div className="min-h-screen bg-gray-50 pb-20 font-sans">
                    <header className="bg-white shadow-sm sticky top-0 z-30 border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <button onClick={onBack} className="p-2 hover:bg-gray-100 rounded-full transition text-gray-500 hover:text-temple-600"><ArrowLeft className="w-6 h-6"/></button>
                                <div>
                                    <h1 className="font-bold text-lg text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î</h1>
                                    <p className="text-xs text-gray-400 font-medium">TEMPLE MANAGEMENT SYSTEM</p>
                                </div>
                            </div>
                            <div className="flex items-center bg-gray-100 rounded-lg px-3 py-1.5 border border-gray-200 hover:border-temple-300 transition">
                                <User className={`w-4 h-4 mr-2 ${userRole==='admin'?'text-red-500':userRole==='staff'?'text-blue-500':'text-gray-500'}`}/>
                                <select className="bg-transparent outline-none text-sm text-gray-700 font-bold cursor-pointer" value={userRole} onChange={handleRoleChange}>
                                    <option value="donor">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</option>
                                    <option value="staff">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (Staff)</option>
                                    <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Admin)</option>
                                </select>
                            </div>
                        </div>
                        {/* Tabs */}
                        <div className="max-w-7xl mx-auto px-4 flex gap-8 overflow-x-auto hide-scrollbar border-t border-gray-100 pt-1">
                            {[
                                { id: 'donate', label: '‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ/‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô', icon: PlusCircle, role: 'all' },
                                { id: 'dashboard', label: '‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î', icon: LayoutDashboard, role: 'staff' },
                                { id: 'announcer', label: '‡πÇ‡∏Ü‡∏©‡∏Å', icon: Megaphone, role: 'staff' },
                                { id: 'approval', label: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', icon: CheckCircle, role: 'admin' },
                                { id: 'settings', label: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤', icon: Settings, role: 'admin' }
                            ].filter(t => (t.role === 'all' || userRole !== 'donor') && (t.role !== 'admin' || userRole === 'admin')).map(t => (
                                <button 
                                    key={t.id}
                                    onClick={() => setTab(t.id)}
                                    className={`flex items-center py-3 border-b-2 text-sm font-bold transition whitespace-nowrap px-1 ${tab === t.id ? 'border-temple-600 text-temple-600' : 'border-transparent text-gray-500 hover:text-gray-800'}`}
                                >
                                    <t.icon className={`w-4 h-4 mr-2 ${tab===t.id?'text-temple-600':'text-gray-400'}`} /> {t.label}
                                </button>
                            ))}
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto p-4 md:p-8 animate-fade-in">
                        {tab === 'donate' && <DonationForm userRole={userRole} onSave={onAdd} systemConfig={systemConfig} />}
                        {tab === 'dashboard' && <Dashboard donations={donations} userRole={userRole} onUpdateDonation={onUpdate} />}
                        {tab === 'announcer' && <AnnouncerPanel donations={donations} onUpdateStatus={(id, status) => { const item = donations.find(d=>d.id===id); if(item) onUpdate({...item, announced: status}); }} />}
                        {tab === 'approval' && <ApprovalPanel donations={donations} onApprove={(id)=>{const item=donations.find(d=>d.id===id);if(item)onUpdate({...item, status:'approved'})}} onReject={(id)=>{const item=donations.find(d=>d.id===id);if(item)onUpdate({...item, status:'rejected'})}} />}
                        {tab === 'settings' && <SettingsPanel config={systemConfig} onSave={onUpdateConfig} onResetDatabase={onResetDatabase} />}
                    </main>

                    {showLogin && <LoginModal role={pendingRole} onClose={()=>setShowLogin(false)} onLoginSuccess={(role)=>{setUserRole(role); setShowLogin(false); toast(`‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ${role} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);}} />}
                </div>
            );
        };

        // ==========================================
        // 5. APP ROOT (Global State & Logic)
        // ==========================================
        const App = () => {
            const [view, setView] = useState('home');
            const [user, setUser] = useState(null);
            const [donations, setDonations] = useState([]);
            const [userRole, setUserRole] = useState('donor');
            const [config, setConfig] = useState({ eventName: '‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', isOnline: true });
            const [demo, setDemo] = useState(false);
            const [permError, setPermError] = useState(false);
            
            // Local State for Demo Mode
            const [localDonations, setLocalDonations] = useState([
                { id:'1', dateTime: new Date(Date.now() - 10000000).toISOString(), name:'‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏à‡∏î‡∏µ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç', purpose:'‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ 500 ‡∏ö‡∏≤‡∏ó', amount:500, method:'‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô', status:'approved', announced:true },
                { id:'2', dateTime: new Date().toISOString(), name:'‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á', purpose:'‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô (‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß)', amount:2000, method:'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î', status:'pending', roongTaanDate:'2026-04-15' }
            ]);
            const [localNews, setLocalNews] = useState([]);

            // Initialize Auth
            useEffect(() => { 
                const setupAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (error) {
                        console.warn("Auth failed, falling back to demo mode", error);
                        setDemo(true);
                    }
                };
                setupAuth();
                
                const unsubscribe = onAuthStateChanged(auth, u => { 
                    setUser(u); 
                    if(!u) setDemo(true); // If no user, force demo
                });
                return () => unsubscribe();
            }, []);

            // Data Sync
            useEffect(() => {
                if (demo) { setDonations(localDonations); return; }
                if (!user) return; // Wait for auth
                
                // Donations Listener
                const unsub1 = onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'donations')), 
                    s => { 
                        setDonations(s.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>new Date(b.dateTime)-new Date(a.dateTime))); 
                        setPermError(false); 
                    },
                    e => { 
                        console.error("Firestore Error:", e);
                        if(e.code==='permission-denied') setPermError(true);
                        else setDemo(true); // Other errors -> Demo mode
                    }
                );

                // Config Listener
                const configRef = doc(db, 'artifacts', appId, 'settings', 'config');
                const unsub2 = onSnapshot(configRef, s => { 
                    if(s.exists()) setConfig(s.data()); 
                    else if(!demo) setDoc(configRef, { eventName: '‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', isOnline: true }).catch(console.error);
                }, e => console.log("Config read error (minor):", e));

                return () => { unsub1(); unsub2(); };
            }, [user, demo, localDonations]); // Add localDonations to dependency to refresh on demo update

            // Handlers
            const handlers = {
                add: async (d) => { 
                    if(demo) { setLocalDonations(prev => [d, ...prev]); return; }
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'donations'), d); 
                },
                update: async (d) => { 
                    if(demo) { setLocalDonations(prev => prev.map(x=>x.id===d.id?d:x)); return; }
                    const {id,...data}=d; await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'donations', id), data); 
                },
                config: async (c) => { 
                    if(demo) { setConfig(c); return; }
                    await setDoc(doc(db, 'artifacts', appId, 'settings', 'config'), c); 
                },
                reset: async () => { 
                    if(demo) { setLocalDonations([]); return; }
                    const s = await getDocs(collection(db,'artifacts',appId,'public','data','donations')); 
                    const promises = s.docs.map(d => deleteDoc(d.ref));
                    await Promise.all(promises);
                    alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); 
                }
            };

            // Error Screen
            if (permError) return <PermissionErrorScreen onUseDemo={()=>{setPermError(false); setDemo(true);}} />;

            return (
                <ToastProvider>
                    {demo && (
                        <div className="bg-yellow-500 text-white text-xs text-center py-1 font-bold fixed top-0 w-full z-[100]">
                            ‚ö†Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï (Offline Demo Mode) - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏£‡∏¥‡∏á
                        </div>
                    )}
                    {view === 'home' ? 
                        <OfficialWebsite 
                            onNavigate={setView} 
                            donations={donations} 
                            userRole={userRole} 
                            setUserRole={setUserRole} 
                            user={user}
                        /> 
                    : 
                        <DonationSystem 
                            onBack={()=>setView('home')} 
                            donations={donations} 
                            onAdd={handlers.add} 
                            onUpdate={handlers.update} 
                            userRole={userRole} 
                            setUserRole={setUserRole} 
                            systemConfig={config} 
                            onUpdateConfig={handlers.config} 
                            onResetDatabase={handlers.reset} 
                            user={user}
                        />
                    }
                </ToastProvider>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
